<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç»¿ - æ™ºæ…§å†œåœºåŠ©æ‰‹</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="æ™ºæ…§å†œåœºAIåŠ©æ‰‹ï¼Œæä¾›ä¸“ä¸šçš„å†œä¸šå’¨è¯¢å’ŒæŒ‡å¯¼æœåŠ¡">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å°ç»¿åŠ©æ‰‹">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/logo.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://webapi.amap.com/loader.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #e0f2e9 0%, #c8e6c9 100%) !important;
        }

        .gradient-bg .text-white, .gradient-bg .text-white\/70 {
            color: #222 !important;
        }

        .gradient-bg .glass-effect {
            background: rgba(255,255,255,0.7) !important;
            border: 1px solid rgba(0,0,0,0.08) !important;
        }

        .bg-pattern {
            background-color: #f0f8f0;
            background-image: linear-gradient(rgba(144, 238, 144, 0.1) 1px, transparent 1px),
                            linear-gradient(90deg, rgba(144, 238, 144, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .chat-bubble {
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        #avatar-container {
            background: radial-gradient(circle, rgba(34, 197, 94, 0.2) 0%, rgba(240, 248, 240, 0.1) 100%);
            position: relative;
        }

        .nav-button {
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
        }

        .modal {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
        }

        .service-card {
            transition: all 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3);
        }

        #map-container {
            border-radius: 12px;
            overflow: hidden;
        }

        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .voice-wave {
            width: 4px;
            height: 20px;
            background: #22c55e;
            margin: 0 2px;
            border-radius: 2px;
            animation: wave 1s infinite ease-in-out;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }

        @keyframes wave {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }

        .nav-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            min-width: 200px;
            z-index: 9999;
        }

        .nav-dropdown a {
            display: block;
            padding: 8px 12px;
            color: white;
            text-decoration: none;
            transition: background 0.2s;
        }

        .nav-dropdown a:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .nav-item:hover .nav-dropdown {
            display: block;
        }

        .context-menu {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            z-index: 1000;
            display: none;
        }

        .context-menu a {
            display: block;
            padding: 8px 12px;
            color: white;
            text-decoration: none;
        }

        .context-menu a:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .divider {
            width: 5px;
            background: #ddd;
            cursor: ew-resize;
            position: relative;
            z-index: 10;
        }

        .emoji {
            font-size: 1.5em;
            margin-right: 5px;
        }

        .chat-panel {
            transition: width 0.2s ease;
        }

        .vertical-layout .main-container {
            flex-direction: column;
        }

        .vertical-layout .chat-panel {
            width: 100%;
            height: 40%;
        }

        .compact-layout .chat-panel {
            width: 100%;
            position: fixed;
            bottom: 0;
            height: 50%;
            z-index: 10;
        }

        .compact-layout #avatar-container {
            height: 100vh;
        }

        .dark-theme {
            background: linear-gradient(135deg, #1e3a8a 0%, #4c1d95 100%);
        }

        .light-theme {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
        }

        .light-theme .glass-effect {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .light-theme .text-white {
            color: #1f2937;
        }

        .light-theme .text-white/70 {
            color: #4b5563;
        }

        .light-theme .bg-gradient-to-br {
            background: linear-gradient(to bottom right, #60a5fa, #a78bfa);
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            .chat-panel {
                width: 100% !important;
                height: 40%;
            }
            .divider {
                display: none;
            }
            .modal {
                margin: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg overflow-hidden">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="glass-effect border-b border-white/20 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-emerald-500 rounded-lg flex items-center justify-center">
                    <span class="text-white font-bold text-lg">ğŸŒ±</span>
                </div>
                <div>
                    <h1 class="text-white font-semibold text-xl" id="app-title">å°ç»¿ - æ™ºæ…§å†œåœºåŠ©æ‰‹</h1>
                    <p class="text-white/70 text-sm">å†œä¸šå’¨è¯¢ â€¢ é‚®ä»¶é€šçŸ¥ â€¢ å¤©æ°”æŸ¥è¯¢</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="nav-item relative">
                    <button id="location-btn" class="nav-button glass-effect px-4 py-2 rounded-lg text-white hover:bg-white/20 transition-all duration-200 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                        </svg>
                        <span id="location-text">è·å–ä½ç½®</span>
                    </button>
                    <div class="nav-dropdown">
                        <a href="#" data-action="current-location">è·å–å½“å‰ä½ç½®</a>
                        <a href="#" data-action="search-poi">æœç´¢é™„è¿‘POI</a>
                        <a href="#" data-action="route-plan">è·¯çº¿è§„åˆ’</a>
                    </div>
                </div>
                <div class="nav-item relative">
                    <button id="services-btn" class="nav-button bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all duration-200">
                        æœåŠ¡ä¸­å¿ƒ
                    </button>
                    <div class="nav-dropdown">
                        <a href="#" data-service="ai-chat">å†œä¸šæ™ºèƒ½å’¨è¯¢</a>
                        <a href="#" data-service="navigation">åœ°å›¾å¯¼èˆª</a>
                        <a href="#" data-service="email">é‚®ä»¶æœåŠ¡</a>
                        <a href="#" data-service="weather">å¤©æ°”æŸ¥è¯¢</a>
                        <a href="#" data-service="settings">ç”¨æˆ·è®¾ç½®</a>
                        <a href="#" data-service="system-status">ç³»ç»ŸçŠ¶æ€</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container flex h-[calc(100vh-80px)]">
        <!-- å·¦ä¾§ï¼š3Dæ•°å­—äººå±•ç¤ºåŒº -->
        <div class="flex-1 relative" id="avatar-container">
            <canvas id="three-canvas" class="w-full h-full"></canvas>
            <!-- æ•°å­—äººçŠ¶æ€é¢æ¿ -->
            <div class="absolute top-6 left-6 glass-effect rounded-xl p-4 text-white">
                <div class="flex items-center gap-3">
                    <div id="status-indicator" class="w-3 h-3 bg-green-400 rounded-full pulse-animation"></div>
                    <span id="status-text" class="text-sm font-medium"><span class="emoji">ğŸ˜</span>çŠ¶æ€: å¾…æœº</span>
                </div>
                <div class="mt-2 text-xs opacity-75 space-y-1">
                    <div>è¯­éŸ³è¯†åˆ«: <span id="speech-status" class="text-green-400">å¾…æœºä¸­</span></div>
                    <div>ä½ç½®æœåŠ¡: <span id="location-status" class="text-yellow-400">æœªè·å–</span></div>
                    <div>åœ¨çº¿ç”¨æˆ·: <span class="text-blue-400" id="online-users">1,247</span></div>
                    <div>å¤©æ°”: <span id="weather-status" class="text-gray-400">æœªæŸ¥è¯¢</span></div>
                </div>
            </div>
            <!-- åŠŸèƒ½æ§åˆ¶é¢æ¿ -->
            <div class="absolute bottom-6 left-6 flex flex-col gap-3">
                <button id="voice-btn" class="glass-effect w-16 h-16 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all duration-200 relative">
                    <svg id="mic-icon" class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                    </svg>
                    <div id="voice-waves" class="absolute inset-0 rounded-full hidden flex items-center justify-center">
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                        <div class="voice-wave"></div>
                    </div>
                </button>
                <button id="voice-pause-btn" class="glass-effect w-16 h-16 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all duration-200 hidden">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </button>
                <button id="map-toggle" class="glass-effect w-16 h-16 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all duration-200">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12 1.586l-4 4v12.828l4-4V1.586zM3.707 3.293A1 1 0 002 4v10a1 1 0 10.293.707L6 18.414V5.586L3.707 3.293zM17.707 5.293L14 1.586v12.828l2.293 2.293A1 1 0 0018 16V6a1 1 0 00-.293-.707z" clip-rule="evenodd"></path>
                    </svg>
                </button>
                <button id="avatar-controls" class="glass-effect w-16 h-16 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all duration-200">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <!-- åœ°å›¾å®¹å™¨ -->
            <div id="map-overlay" class="absolute inset-4 glass-effect rounded-xl hidden">
                <div class="p-4 border-b border-white/20 flex justify-between items-center">
                    <h3 class="text-white font-medium">åœ°å›¾å¯¼èˆª</h3>
                    <button id="close-map" class="text-white/70 hover:text-white">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
                <div id="map-container" class="w-full h-[calc(100%-60px)]"></div>
                <div class="p-4">
                    <input id="poi-search" type="text" placeholder="æœç´¢é™„è¿‘åœ°ç‚¹..." class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50">
                    <div id="poi-results" class="mt-2 max-h-40 overflow-y-auto"></div>
                </div>
            </div>
            <!-- 3Dæ¨¡å‹å³é”®èœå• -->
            <div id="context-menu" class="context-menu">
                <a href="#" data-action="wave">æŒ¥æ‰‹åŠ¨ç”»</a>
                <a href="#" data-action="idle">å¾…æœºåŠ¨ç”»</a>
                <a href="#" data-action="dance">è·³èˆåŠ¨ç”»</a>
                <a href="#" data-action="reset">é‡ç½®è§†è§’</a>
            </div>
        </div>
        <!-- åˆ†éš”æ¡ -->
        <div id="divider" class="divider"></div>
        <!-- å³ä¾§ï¼šèŠå¤©ç•Œé¢ -->
        <div class="chat-panel glass-effect flex flex-col border-l border-white/20" id="chat-panel">
            <div class="p-6 border-b border-white/20">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center relative">
                        <span class="text-white font-bold text-lg">ğŸŒ±</span>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white"></div>
                    </div>
                    <div>
                        <h2 class="text-white font-semibold text-lg" id="chat-header">å°ç»¿ - æ™ºæ…§å†œåœºåŠ©æ‰‹</h2>
                        <p class="text-white/70 text-sm">ä¸“ä¸šå†œä¸šçŸ¥è¯†ï¼Œè´´å¿ƒæœåŠ¡</p>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-2 gap-3 text-xs">
                    <div class="glass-effect rounded-lg p-2 text-center">
                        <div class="text-white/60">ä»Šæ—¥å¯¹è¯</div>
                        <div class="text-white font-semibold" id="chat-count">0</div>
                    </div>
                    <div class="glass-effect rounded-lg p-2 text-center">
                        <div class="text-white/60">å“åº”æ—¶é—´</div>
                        <div class="text-green-400 font-semibold" id="response-time">0.8s</div>
                    </div>
                </div>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4">
                <div class="chat-bubble">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-xs font-bold">ğŸŒ±</span>
                        </div>
                        <div class="glass-effect rounded-lg p-3 max-w-xs">
                            <p class="text-white text-sm">æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„æ™ºæ…§å†œåœºåŠ©æ‰‹å°ç»¿ï¼ğŸŒ±<br>å¯ä»¥å¸®æ‚¨ï¼š<br>ğŸŒ¾ å†œä¸šå’¨è¯¢<br>ğŸ—ºï¸ åœ°å›¾å¯¼èˆª<br>ğŸ“§ é‚®ä»¶é€šçŸ¥<br>ğŸŒ¤ï¸ å¤©æ°”æŸ¥è¯¢<br>æœ‰ä»€ä¹ˆå†œä¸šé—®é¢˜æˆ‘å¯ä»¥å¸®æ‚¨è§£ç­”å—ï¼Ÿ</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-white/20">
                <div class="flex gap-3">
                    <input
                        id="message-input"
                        type="text"
                        placeholder="å’Œå°ç»¿èŠèŠå†œä¸šé—®é¢˜å§~"
                        class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:border-white/40 transition-colors"
                    >
                    <button id="send-btn" class="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all duration-200 font-medium">
                        å‘é€
                    </button>
                </div>
                <div class="mt-3 flex gap-2 flex-wrap">
                    <button class="quick-action bg-white/10 text-white text-xs px-3 py-2 rounded-full hover:bg-white/20 transition-colors" data-action="navigation">ğŸ“ å¯¼èˆªæœåŠ¡</button>
                    <button id="refresh-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">ğŸ” åˆ·æ–°æ•°æ®åº“å†…å®¹</button>
                    <button class="quick-action bg-white/10 text-white text-xs px-3 py-2 rounded-full hover:bg-white/20 transition-colors" data-action="settings">âš™ï¸ è®¾ç½®</button>
                    <button class="quick-action bg-white/10 text-white text-xs px-3 py-2 rounded-full hover:bg-white/20 transition-colors" data-action="history">ğŸ“œ å†å²è®°å½•</button>
                    <button id="send-suggestion" class="quick-action bg-blue-500 text-white text-xs px-3 py-2 rounded-full hover:bg-blue-600 transition-colors">ğŸ’¡ å‘é€å»ºè®®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æœåŠ¡ä¸­å¿ƒæ¨¡æ€æ¡† -->
    <div id="services-modal" class="fixed inset-0 modal hidden flex items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-8 max-w-4xl w-full m-4 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-white text-2xl font-bold">æœåŠ¡ä¸­å¿ƒ</h2>
                <button id="close-services" class="text-white/70 hover:text-white">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="service-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-white text-lg font-semibold mb-2">AIæ™ºèƒ½å¯¹è¯</h3>
                    <p class="text-white/70 text-sm mb-4">åŸºäºDeepSeek AIçš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€å¯¹è¯</p>
                    <div class="text-xs text-green-400 mb-2">âœ… å·²é›†æˆ DeepSeek API</div>
                    <button class="service-btn w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition-colors" data-service="ai-chat">
                        å¼€å§‹å¯¹è¯
                    </button>
                </div>
                <div class="service-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12 1.586l-4 4v12.828l4-4V1.586zM3.707 3.293A1 1 0 002 4v10a1 1 0 00.293.707L6 18.414V5.586L3.707 3.293zM17.707 5.293L14 1.586v12.828l2.293 2.293A1 1 0 0018 16V6a1 1 0 00-.293-.707z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-white text-lg font-semibold mb-2">åœ°å›¾å¯¼èˆª</h3>
                    <p class="text-white/70 text-sm mb-4">é«˜å¾·åœ°å›¾é›†æˆï¼Œæä¾›ç²¾å‡†å®šä½å’Œè·¯çº¿è§„åˆ’æœåŠ¡</p>
                    <div class="text-xs text-green-400 mb-2">âœ… å·²é›†æˆ é«˜å¾·åœ°å›¾ API</div>
                    <button class="service-btn w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg transition-colors" data-service="navigation">
                        æ‰“å¼€åœ°å›¾
                    </button>
                </div>
                <div class="service-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                        </svg>
                    </div>
                    <h3 class="text-white text-lg font-semibold mb-2">å‘é€å»ºè®®</h3>
                    <p class="text-white/70 text-sm mb-4">æ¬¢è¿ä¸ºå°ç»¿æå‡ºå®è´µå»ºè®®ï¼Œæ‚¨çš„å»ºè®®å°†å‘é€åˆ°å¼€å‘è€…é‚®ç®±</p>
                    <div class="text-xs text-green-400 mb-2">âœ… å‘é€åˆ° 2138277532@qq.com</div>
                    <button id="service-suggestion-btn" class="service-btn w-full bg-indigo-500 hover:bg-indigo-600 text-white py-2 rounded-lg transition-colors">
                        å‘é€å»ºè®®
                    </button>
                </div>
                <div class="service-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-white text-lg font-semibold mb-2">å¤©æ°”æŸ¥è¯¢</h3>
                    <p class="text-white/70 text-sm mb-4">å®æ—¶å¤©æ°”ä¿¡æ¯æŸ¥è¯¢ï¼ŒåŸºäºOpenWeatherMap API</p>
                    <div class="text-xs text-green-400 mb-2">âœ… å·²é›†æˆ OpenWeatherMap API</div>
                    <button class="service-btn w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg transition-colors" data-service="weather">
                        æŸ¥è¯¢å¤©æ°”
                    </button>
                </div>
                <div class="service-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-white text-lg font-semibold mb-2">ç”¨æˆ·è®¾ç½®</h3>
                    <p class="text-white/70 text-sm mb-4">è‡ªå®šä¹‰é¡µé¢å¸ƒå±€ã€ä¸»é¢˜å’Œ3Dæ¨¡å‹è®¾ç½®</p>
                    <div class="text-xs text-green-400 mb-2">âœ… æœ¬åœ°é…ç½®</div>
                    <button class="service-btn w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors" data-service="settings">
                        æ‰“å¼€è®¾ç½®
                    </button>
                </div>
                <div class="service-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <h3 class="text-white text-lg font-semibold mb-2">ç³»ç»ŸçŠ¶æ€</h3>
                    <p class="text-white/70 text-sm mb-4">æŸ¥çœ‹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’ŒAPIæœåŠ¡å¥åº·åº¦</p>
                    <div class="text-xs text-green-400 mb-2">âœ… ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</div>
                    <button class="service-btn w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg transition-colors" data-service="system-status">
                        ç³»ç»ŸçŠ¶æ€
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="settings-modal" class="fixed inset-0 modal hidden flex items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-8 max-w-md w-full m-4">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-white text-2xl font-bold">ç”¨æˆ·è®¾ç½®</h2>
                <button id="close-settings" class="text-white/70 hover:text-white">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-white text-sm">è§’è‰²åç§°</label>
                    <input id="role-name" type="text" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white" value="å°è‰¾">
                </div>
                <div>
                    <label class="text-white text-sm">3Dæ¨¡å‹</label>
                    <select id="model-select" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white">
                        <option value="xiaoai">å°è‰¾</option>
                        <option value="xiaoming">å°æ˜</option>
                        <option value="xiaohong">å°çº¢</option>
                    </select>
                </div>
                <div>
                    <label class="text-white text-sm">é¡µé¢å¸ƒå±€</label>
                    <select id="layout-select" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white">
                        <option value="horizontal">æ°´å¹³å¸ƒå±€</option>
                        <option value="vertical">å‚ç›´å¸ƒå±€</option>
                        <option value="compact">ç´§å‡‘å¸ƒå±€</option>
                    </select>
                </div>
                <div>
                    <label class="text-white text-sm">ä¸»é¢˜</label>
                    <select id="theme-select" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white">
                        <option value="gradient-bg">é»˜è®¤ä¸»é¢˜</option>
                        <option value="dark-theme">æ·±è‰²ä¸»é¢˜</option>
                        <option value="light-theme">æµ…è‰²ä¸»é¢˜</option>
                    </select>
                </div>
                <div>
                    <label class="text-white text-sm">åŠ¨ç”»é€Ÿåº¦</label>
                    <input id="animation-speed" type="range" min="0.5" max="2" step="0.1" value="1" class="w-full">
                </div>
                <div>
                    <label class="text-white text-sm">é¼ æ ‡è·Ÿéšè§†çº¿</label>
                    <input id="mouse-follow" type="checkbox" class="ml-2" checked>
                </div>
                <div>
                    <label class="text-white text-sm">è¯­éŸ³åé¦ˆ</label>
                    <input id="tts-toggle" type="checkbox" class="ml-2">
                </div>
                <button id="save-settings" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition-colors">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>

    <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
    <div id="history-modal" class="fixed inset-0 modal hidden flex items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-8 max-w-2xl w-full m-4 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-white text-2xl font-bold">å†å²å¯¹è¯</h2>
                <button id="close-history" class="text-white/70 hover:text-white">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div id="history-messages" class="space-y-4"></div>
            <div class="mt-4 flex flex-wrap gap-2">
                <button id="clear-history" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">æ¸…ç©ºå†å²</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notification-container"></div>

    <!-- åŠ è½½æç¤º -->
    <div id="loading" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="glass-effect rounded-xl p-8 text-center">
            <div class="typing-indicator justify-center mb-4">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <p class="text-white font-medium">æ­£åœ¨åˆå§‹åŒ–å°ç»¿ç³»ç»Ÿ...</p>
            <p class="text-white/70 text-sm mt-2">åŠ è½½æ™ºæ…§å†œåœºåŠ©æ‰‹ä¸­...</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼Œç”¨äºä¿å­˜æ•°æ®åº“å†…å®¹
        let databaseContent = "";

        // State Management
        const state = {
            shouldInjectDatabase: false,
            chatCount: 0,
            responseTime: 0.8,
            location: null,
            isVoiceActive: false,
            mapVisible: false,
            servicesModalVisible: false,
            settingsModalVisible: false,
            historyModalVisible: false,
            onlineUsers: 1247,
            speechRecognition: null,
            currentPosition: null,
            map: null,
            model: null,
            mixer: null,
            animations: {},
            currentState: 'Idle',
            animationSpeed: 1,
            ttsEnabled: false,
            layout: 'horizontal',
            theme: 'gradient-bg',
            chatHistory: [],
            roleName: 'å°ç»¿',
            currentModel: 'xiaoai',
            mouseFollow: true,
            mousePosition: { x: 0, y: 0 },
            // æ–°å¢çŠ¶æ€
            currentExpression: 'neutral', // å½“å‰è¡¨æƒ…
            currentEmote: null, // å½“å‰åŠ¨ä½œ
            isSpeaking: false, // æ˜¯å¦æ­£åœ¨è¯´è¯
            availableExpressions: ['angry', 'surprised', 'sad', 'happy', 'neutral'], // å¯ç”¨è¡¨æƒ…
            availableStates: ['idle', 'walking', 'running', 'sitting', 'standing'], // å¯ç”¨çŠ¶æ€
            availableEmotes: ['yes', 'no', 'punch', 'thumbsup'] // å¯ç”¨åŠ¨ä½œ
        };

        // Model Configurations
        const models = {
            xiaoai: {
                url: 'https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb', // Replace with actual chibi model URL
                name: 'å°è‰¾',
                scale: 0.5
            },
            xiaoming: {
                url: 'https://threejs.org/examples/models/gltf/Horse.glb', // Replace with actual chibi model URL
                name: 'å°æ˜',
                scale: 0.5
            },
            xiaohong: {
                url: 'https://threejs.org/examples/models/gltf/Parrot.glb', // Replace with actual chibi model URL
                name: 'å°çº¢',
                scale: 0.5
            }
        };

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `floating-notification glass-effect rounded-lg p-4 text-white ${type === 'error' ? 'bg-red-500/80' : 'bg-blue-500/80'}`;
            notification.innerHTML = message;
            document.getElementById('notification-container').appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
            playSound('notification');
        }

        function updateStatusPanel() {
            document.getElementById('chat-count').textContent = state.chatCount;
            document.getElementById('response-time').textContent = `${state.responseTime.toFixed(1)}s`;
            document.getElementById('online-users').textContent = state.onlineUsers;
            document.getElementById('location-status').textContent = state.location ? 'å·²è·å–' : 'æœªè·å–';
            document.getElementById('speech-status').textContent = state.isVoiceActive ? 'è¯†åˆ«ä¸­' : 'å¾…æœºä¸­';

            // æ›´æ–°è¡¨æƒ…çŠ¶æ€
            const emojis = {
                'neutral': 'ğŸ˜',
                'angry': 'ğŸ˜ ',
                'surprised': 'ğŸ˜²',
                'sad': 'ğŸ˜¢',
                'happy': 'ğŸ˜Š',
                'Idle': 'ğŸ˜',
                'Thinking': 'ğŸ¤”',
                'Replying': 'ğŸ’¬'
            };

            let statusText = state.currentState;
            if (state.currentEmote) {
                statusText = `${state.currentEmote} åŠ¨ä½œ`;
            }

            const emoji = emojis[state.currentExpression] || emojis[state.currentState] || 'ğŸ˜';
            document.getElementById('status-text').innerHTML = `<span class="emoji">${emoji}</span>çŠ¶æ€: ${statusText}`;
        }

        function playSound(type) {
            const sounds = {
                message: new Audio('/22.mp3'), // Replace with actual sound URL
                notification: new Audio('/11.mp3') // Replace with actual sound URL
            };
            if (sounds[type]) {
                sounds[type].play().catch(() => console.log('Sound playback failed'));
            }
        }

        // Three.js 3D Avatar Setup
        function initThreeJS() {
            const canvas = document.getElementById('three-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);

            // Orbit Controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 1;
            controls.maxDistance = 5;

            // Load Model
            function loadModel(modelKey) {
                if (state.model) {
                    scene.remove(state.model);
                    state.model = null;
                    state.mixer = null;
                    state.animations = {};
                }
                const loader = new THREE.GLTFLoader();
                loader.load(
                    models[modelKey].url,
                    (gltf) => {
                        state.model = gltf.scene;
                        state.model.scale.set(0.3, 0.3, 0.3);
                        state.model.position.set(0, -1, 0);
                        scene.add(state.model);

                        // Initialize Animations
                        state.mixer = new THREE.AnimationMixer(state.model);

                        // å¤„ç†æ‰€æœ‰åŠ¨ç”»
                        gltf.animations.forEach((clip) => {
                            state.animations[clip.name] = state.mixer.clipAction(clip);
                        });

                        // è®¾ç½®é»˜è®¤çŠ¶æ€
                        if (state.animations['Idle']) {
                            state.animations['Idle'].play();
                        }

                        // åˆå§‹åŒ–è¡¨æƒ…
                        if (modelKey === 'xiaoai') {
                            // åˆå§‹åŒ–è¡¨æƒ…å½¢æ€ç›®æ ‡
                            state.model.traverse((node) => {
                                if (node.isSkinnedMesh) {
                                    node.morphTargetInfluences = node.morphTargetInfluences || [];
                                }
                            });
                            setExpression('neutral');
                        }
                        state.currentModel = modelKey;
                        updateRoleDisplay();
                        showNotification(`å·²åˆ‡æ¢åˆ°${models[modelKey].name}`);
                    },
                    undefined,
                    (error) => {
                        console.error('Model Loading Error:', error);
                        showNotification('æ— æ³•åŠ è½½3Dæ¨¡å‹', 'error');
                        // Fallback to sphere
                        const geometry = new THREE.SphereGeometry(0.3, 32, 32);
                        const material = new THREE.MeshBasicMaterial({ color: 0xff6f61, wireframe: true });
                        state.model = new THREE.Mesh(geometry, material);
                        scene.add(state.model);
                    }
                );
            }

            loadModel(state.currentModel);
            camera.position.set(0, 0.5, 2);

            // Mouse Following
            let headBone = null;
            function updateHeadRotation() {
                if (state.model && state.mouseFollow) {
                    if (!headBone) {
                        state.model.traverse((child) => {
                            if (child.isBone && child.name.toLowerCase().includes('head')) {
                                headBone = child;
                            }
                        });
                    }
                    if (headBone) {
                        const mouseX = (state.mousePosition.x / window.innerWidth) * 2 - 1;
                        const mouseY = -(state.mousePosition.y / window.innerHeight) * 2 + 1;
                        headBone.rotation.y = mouseX * 0.5;
                        headBone.rotation.x = mouseY * 0.3;
                    }
                }
            }

            // Animation Loop
            const clock = new THREE.Clock();
            function animate() {
                requestAnimationFrame(animate);
                const delta = clock.getDelta();
                if (state.mixer) {
                    state.mixer.update(delta * state.animationSpeed);
                }
                updateHeadRotation();
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            // Handle Window Resize
            window.addEventListener('resize', () => {
                camera.aspect = canvas.clientWidth / canvas.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            });

            // Mouse Movement
            document.addEventListener('mousemove', (e) => {
                state.mousePosition.x = e.clientX;
                state.mousePosition.y = e.clientY;
            });

            // Context Menu
            const contextMenu = document.getElementById('context-menu');
            canvas.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                contextMenu.style.display = 'block';
                contextMenu.style.left = `${e.clientX}px`;
                contextMenu.style.top = `${e.clientY}px`;
            });

            document.addEventListener('click', () => {
                contextMenu.style.display = 'none';
            });

            return { loadModel };
        }

        // 3D Model Interactions
        function playAnimation(name) {
            if (state.animations[name]) {
                // å¦‚æœæ˜¯è¡¨æƒ…åŠ¨ç”»ï¼Œä¸åœæ­¢å½“å‰åŠ¨ä½œ
                const isEmote = state.availableEmotes.includes(name.toLowerCase());
                const isExpression = state.availableExpressions.includes(name.toLowerCase());

                if (!isEmote && !isExpression) {
                    // å¦‚æœæ˜¯çŠ¶æ€åŠ¨ç”»ï¼Œåœæ­¢æ‰€æœ‰å…¶ä»–çŠ¶æ€åŠ¨ç”»
                    Object.keys(state.animations).forEach(key => {
                        if (!state.availableEmotes.includes(key.toLowerCase()) &&
                            !state.availableExpressions.includes(key.toLowerCase())) {
                            state.animations[key].stop();
                        }
                    });
                }

                // æ’­æ”¾æ–°åŠ¨ç”»
                if (isEmote) {
                    // åŠ¨ä½œæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œæ’­æ”¾åå›åˆ°ä¹‹å‰çš„çŠ¶æ€
                    const action = state.animations[name];
                    action.setLoop(THREE.LoopOnce);
                    action.clampWhenFinished = true;
                    action.reset().play();
                    state.currentEmote = name;

                    // åŠ¨ä½œå®Œæˆåæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€
                    setTimeout(() => {
                        state.currentEmote = null;
                        if (state.animations[state.currentState]) {
                            state.animations[state.currentState].reset().play();
                        }
                    }, action.getClip().duration * 1000 / state.animationSpeed);
                } else {
                    state.animations[name].reset().play();
                    if (!isExpression) {
                        state.currentState = name;
                    }
                }

                showNotification(`æ’­æ”¾${name}åŠ¨ç”»`);
                updateStatusPanel();
            } else {
                showNotification(`åŠ¨ç”»${name}ä¸å¯ç”¨`, 'error');
            }
        }

        // è®¾ç½®è¡¨æƒ…
        function setExpression(expression) {
            if (!state.availableExpressions.includes(expression)) return;

            // é‡ç½®æ‰€æœ‰è¡¨æƒ…
            state.model.traverse((node) => {
                if (node.isSkinnedMesh && node.morphTargetInfluences) {
                    for (let i = 0; i < node.morphTargetInfluences.length; i++) {
                        node.morphTargetInfluences[i] = 0;
                    }
                }
            });

            // è®¾ç½®æ–°è¡¨æƒ…
            state.model.traverse((node) => {
                if (node.isSkinnedMesh && node.morphTargetDictionary) {
                    const morphTargetIndex = node.morphTargetDictionary[expression];
                    if (morphTargetIndex !== undefined) {
                        node.morphTargetInfluences[morphTargetIndex] = 1;
                    }
                }
            });

            state.currentExpression = expression;
            updateStatusPanel();
        }

        function resetCamera() {
            const canvas = document.getElementById('three-canvas');
            const camera = canvas.getContext('webgl').getParameter(canvas.getContext('webgl').CURRENT_PROGRAM).camera || { position: { set: () => {} } };
            camera.position.set(0, 0.5, 2);
            showNotification('è§†è§’å·²é‡ç½®');
        }

        function setState(stateName) {
            state.currentState = stateName;

            // çŠ¶æ€ä¸åŠ¨ç”»å’Œè¡¨æƒ…çš„æ˜ å°„ - æ ¹æ®ç”¨æˆ·éœ€æ±‚è°ƒæ•´
            const stateAnimations = {
                'Thinking': 'Running',     // æ€è€ƒæ—¶è¿›å…¥å¥”è·‘çŠ¶æ€
                'UserInput': 'Dance',      // ç”¨æˆ·è¾“å…¥æ—¶è¿›å…¥è·³èˆçŠ¶æ€
                'Replying': 'Wave',        // å›å¤æ—¶æŒ¥æ‰‹
                'Idle': 'Idle',           // å›å¤å®Œæ¯•è¿›å…¥å¾…æœºçŠ¶æ€
                'Happy': 'Dance',
                'Curious': 'Idle',
                'Sad': 'Idle'
            };

            const stateExpressions = {
                'Thinking': 'neutral',     // æ€è€ƒæ—¶ä¿æŒä¸­æ€§è¡¨æƒ…
                'UserInput': 'happy',      // ç”¨æˆ·è¾“å…¥æ—¶å¼€å¿ƒè¡¨æƒ…
                'Replying': 'happy',       // å›å¤æ—¶å¼€å¿ƒè¡¨æƒ…
                'Idle': 'neutral',        // å¾…æœºæ—¶ä¸­æ€§è¡¨æƒ…
                'Happy': 'happy',
                'Curious': 'surprised',
                'Sad': 'sad'
            };

            // è®¾ç½®åŠ¨ç”»
            if (stateAnimations[stateName] && state.animations[stateAnimations[stateName]]) {
                playAnimation(stateAnimations[stateName]);
            }

            // è®¾ç½®è¡¨æƒ…
            if (stateExpressions[stateName]) {
                setExpression(stateExpressions[stateName]);
            }

            updateStatusPanel();
        }

        // Highmaps API Integration
        function initMap() {
            if (!window.AMap) {
                showNotification('é«˜å¾·åœ°å›¾APIæœªåŠ è½½', 'error');
                return;
            }
            state.map = new AMap.Map('map-container', {
                zoom: 14,
                center: [116.397428, 39.90923],
                viewMode: '3D',
                pitch: 45,
                mapStyle: 'amap://styles/light'
            });
            state.map.plugin(['AMap.ToolBar', 'AMap.Scale'], function() {
                state.map.addControl(new AMap.ToolBar());
                state.map.addControl(new AMap.Scale());
            });
        }

        function getCurrentLocation() {
            if (!window.AMap || !state.map) {
                showNotification('åœ°å›¾å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•', 'error');
                return;
            }

            window.AMap.plugin('AMap.Geolocation', () => {
                const geolocation = new window.AMap.Geolocation({
                    enableHighAccuracy: true,
                    timeout: 10000,
                    buttonPosition: 'RB',
                    buttonOffset: new window.AMap.Pixel(10, 20)
                });
                state.map.addControl(geolocation);
                geolocation.getCurrentPosition((status, result) => {
                    if (status === 'complete') {
                        state.currentPosition = result.position;
                        state.map.setCenter(state.currentPosition);
                        document.getElementById('location-text').textContent = 'å½“å‰ä½ç½®';
                        state.location = result.formattedAddress;
                        updateStatusPanel();
                        showNotification('ä½ç½®è·å–æˆåŠŸï¼š' + state.location);
                    } else {
                        showNotification('æ— æ³•è·å–ä½ç½®ï¼Œè¯·æ£€æŸ¥æƒé™', 'error');
                    }
                });
            });
        }

        function searchPOI(keyword) {
            if (!window.AMap || !state.map) {
                showNotification('åœ°å›¾å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•', 'error');
                return;
            }

            window.AMap.plugin('AMap.PlaceSearch', () => {
                const placeSearch = new window.AMap.PlaceSearch({
                    pageSize: 10,
                    pageIndex: 1,
                    city: 'å…¨å›½',
                    map: state.map
                });
                placeSearch.search(keyword, (status, result) => {
                    if (status === 'complete' && result.poiList) {
                        const poiResults = document.getElementById('poi-results');
                        poiResults.innerHTML = '';
                        result.poiList.pois.forEach(poi => {
                            const div = document.createElement('div');
                            div.className = 'glass-effect rounded-lg p-2 mb-2 cursor-pointer';
                            div.innerHTML = `<p class="text-white text-sm">${poi.name}</p><p class="text-white/70 text-xs">${poi.address}</p>`;
                            div.onclick = () => {
                                state.map.setCenter(poi.location);
                                new window.AMap.Marker({
                                    map: state.map,
                                    position: poi.location,
                                    title: poi.name
                                });
                            };
                            poiResults.appendChild(div);
                        });
                    } else {
                        showNotification('æœªæ‰¾åˆ°ç›¸å…³åœ°ç‚¹', 'error');
                    }
                });
            });
        }

        function planRoute(destination) {
            if (!window.AMap || !state.map) {
                showNotification('åœ°å›¾å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•', 'error');
                return;
            }

            window.AMap.plugin(['AMap.Driving'], () => {
                const driving = new window.AMap.Driving({
                    map: state.map,
                    policy: window.AMap.DrivingPolicy.LEAST_TIME
                });
                driving.search(state.currentPosition, destination, (status, result) => {
                    if (status === 'complete') {
                        showNotification('è·¯çº¿è§„åˆ’æˆåŠŸ');
                    } else {
                        showNotification('è·¯çº¿è§„åˆ’å¤±è´¥', 'error');
                    }
                });
            });
        }

        // å†œåœºé¢„è®¾ä¿¡æ¯åº“
        const farmKnowledgeBase = {
            // ä½œç‰©ç§æ¤ç›¸å…³
            crops: {
                'æ°´ç¨»': 'æ°´ç¨»æ˜¯é‡è¦çš„ç²®é£Ÿä½œç‰©ï¼Œé€‚å®œåœ¨æ¸©æš–æ¹¿æ¶¦çš„ç¯å¢ƒä¸­ç”Ÿé•¿ï¼Œéœ€è¦å……è¶³çš„æ°´åˆ†å’Œé˜³å…‰ã€‚',
                'å°éº¦': 'å°éº¦æ˜¯ä¸–ç•Œä¸‰å¤§è°·ç‰©ä¹‹ä¸€ï¼Œé€‚åº”æ€§å¼ºï¼Œåœ¨æ¸©å¸¦åœ°åŒºå¹¿æ³›ç§æ¤ã€‚',
                'ç‰ç±³': 'ç‰ç±³æ˜¯é‡è¦çš„ç²®é£Ÿå’Œé¥²æ–™ä½œç‰©ï¼Œå–œæ¸©å–œå…‰ï¼Œå¯¹åœŸå£¤è¦æ±‚ä¸ä¸¥æ ¼ã€‚',
                'å¤§è±†': 'å¤§è±†æ˜¯é‡è¦çš„æ²¹æ–™ä½œç‰©å’Œè›‹ç™½è´¨æ¥æºï¼Œå…·æœ‰å›ºæ°®èƒ½åŠ›ï¼Œèƒ½æ”¹è‰¯åœŸå£¤ã€‚'
            },
            // å†œä¸šæŠ€æœ¯ç›¸å…³
            techniques: {
                'æœ‰æœºå†œä¸š': 'æœ‰æœºå†œä¸šæ˜¯ä¸€ç§ä¸ä½¿ç”¨åŒ–å­¦åˆæˆå†œè¯ã€åŒ–è‚¥çš„å¯æŒç»­å†œä¸šç”Ÿäº§æ–¹å¼ã€‚',
                'ç²¾å‡†å†œä¸š': 'ç²¾å‡†å†œä¸šåˆ©ç”¨ç°ä»£ä¿¡æ¯æŠ€æœ¯ï¼Œå®ç°å†œä¸šç”Ÿäº§çš„ç²¾ç¡®åŒ–ç®¡ç†ã€‚',
                'æ™ºæ…§å†œä¸š': 'æ™ºæ…§å†œä¸šç»“åˆç‰©è”ç½‘ã€å¤§æ•°æ®ã€äººå·¥æ™ºèƒ½ç­‰æŠ€æœ¯ï¼Œæé«˜å†œä¸šç”Ÿäº§æ•ˆç‡ã€‚',
                'èŠ‚æ°´çŒæº‰': 'èŠ‚æ°´çŒæº‰æŠ€æœ¯åŒ…æ‹¬æ»´çŒã€å–·çŒç­‰ï¼Œèƒ½æœ‰æ•ˆæé«˜æ°´èµ„æºåˆ©ç”¨æ•ˆç‡ã€‚'
            },
            // ç—…è™«å®³é˜²æ²»
            pestControl: {
                'ç”Ÿç‰©é˜²æ²»': 'åˆ©ç”¨å¤©æ•Œæ˜†è™«ã€å¾®ç”Ÿç‰©ç­‰ç”Ÿç‰©å› å­é˜²æ²»å†œä¸šå®³è™«çš„æ–¹æ³•ã€‚',
                'ç‰©ç†é˜²æ²»': 'åˆ©ç”¨ç‰©ç†å› å­å¦‚æ¸©åº¦ã€æ¹¿åº¦ã€å…‰ç…§ç­‰é˜²æ²»ç—…è™«å®³ã€‚',
                'åŒ–å­¦é˜²æ²»': 'ä½¿ç”¨å†œè¯é˜²æ²»ç—…è™«å®³ï¼Œéœ€è¦ç§‘å­¦åˆç†ä½¿ç”¨ï¼Œé¿å…ç¯å¢ƒæ±¡æŸ“ã€‚'
            }
        };

        // ä¿¡æ¯æ£€ç´¢å‡½æ•°
        function searchFarmKnowledge(query) {
            const results = [];
            const searchTerms = query.toLowerCase();

            // æœç´¢ä½œç‰©ä¿¡æ¯
            Object.entries(farmKnowledgeBase.crops).forEach(([crop, info]) => {
                if (searchTerms.includes(crop) || crop.includes(searchTerms)) {
                    results.push(`ã€ä½œç‰©çŸ¥è¯†ã€‘${crop}ï¼š${info}`);
                }
            });

            // æœç´¢æŠ€æœ¯ä¿¡æ¯
            Object.entries(farmKnowledgeBase.techniques).forEach(([tech, info]) => {
                if (searchTerms.includes(tech) || tech.includes(searchTerms)) {
                    results.push(`ã€å†œä¸šæŠ€æœ¯ã€‘${tech}ï¼š${info}`);
                }
            });

            // æœç´¢ç—…è™«å®³é˜²æ²»ä¿¡æ¯
            Object.entries(farmKnowledgeBase.pestControl).forEach(([method, info]) => {
                if (searchTerms.includes(method) || method.includes(searchTerms)) {
                    results.push(`ã€ç—…è™«å®³é˜²æ²»ã€‘${method}ï¼š${info}`);
                }
            });

            return results;
        }

        // DeepSeek API Integration
        async function sendToDeepSeek(message) {
            try {
                // é¦–å…ˆæ£€ç´¢é¢„è®¾ä¿¡æ¯
                const knowledgeResults = searchFarmKnowledge(message);
                let systemPrompt = `ä½ æ˜¯å°ç»¿ï¼Œä¸€ä¸ªä¸“ä¸šçš„æ™ºæ…§å†œåœºåŠ©æ‰‹ã€‚ä½ éœ€è¦ç”¨å‹å¥½ã€ä¸“ä¸šçš„è¯­æ°”å›ç­”ç”¨æˆ·çš„å†œä¸šç›¸å…³é—®é¢˜ã€‚ä¸‹é¢æ˜¯å…³äºè¿™ä¸ªæ™ºæ…§å†œåœºé¡¹ç›®çš„ç›¸å…³ä¿¡æ¯ï¼Œå½“ç”¨æˆ·æé—®åˆ°ç›¸å…³é—®é¢˜æ—¶ä½ è¦åšå‡ºå¯¹åº”å›ç­”ã€‚ä¸‹é¢æ˜¯æ™ºæ…§å†œåœºé¡¹ç›®çš„ç›¸å…³ä»‹ç»ï¼Œå½“ç”¨æˆ·é—®åˆ°ç›¸å…³é—®é¢˜æ—¶éœ€è¦åšå‡ºå¯¹åº”å›ç­”æ™ºæ…§å†œç”°ç®¡ç†å¹³å°é¡¹ç›®æ€»ç»“ä¸ AI è®²è§£å‘å¯¼æç¤ºè¯
ä¸€ã€é¡¹ç›®æ€»ç»“
ï¼ˆä¸€ï¼‰é¡¹ç›®æ¦‚è¿°
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°æ˜¯ä¸€ä¸ªåŸºäº SpringBoot + Vue æ¡†æ¶æŠ€æœ¯å¼€å‘çš„ Web åº”ç”¨ç³»ç»Ÿï¼Œæ—¨åœ¨é€šè¿‡ç§‘æŠ€æ‰‹æ®µæå‡å†œä¸šç”Ÿäº§æ•ˆç‡ï¼Œå®ç°å®æ—¶ç›‘æµ‹ã€æ™ºèƒ½ç®¡ç†ï¼Œä¼˜åŒ–å†œäº§å“è´¨é‡ï¼Œå¯¹ç°ä»£å†œä¸šå›­åŒºå»ºè®¾èµ·åˆ°ç¤ºèŒƒå¸¦åŠ¨ä½œç”¨ã€‚éšç€å…¨çƒäººå£å¢é•¿å’Œç²®é£Ÿéœ€æ±‚å¢åŠ ï¼Œä¼ ç»Ÿå†œç”°ç®¡ç†æ–¹å¼å·²æ— æ³•æ»¡è¶³ç°ä»£å†œä¸šå‘å±•éœ€æ±‚ï¼Œæ™ºæ…§å†œç”°å»ºè®¾æˆä¸ºè§£å†³ä¹‹é“ã€‚æœ¬é¡¹ç›®åº”è¿è€Œç”Ÿï¼Œå…·æœ‰é‡è¦ç°å®æ„ä¹‰ï¼šæé«˜ç”Ÿäº§æ•ˆç‡ã€å®ç°æ•°å­—åŒ–è½¬å‹ã€ä¿ƒè¿›ç°ä»£åŒ–å‘å±•ã€æä¾›æ™ºèƒ½åŠŸèƒ½ã€å»ºç«‹ç®¡ç†å¹³å°ã€å®ç°ç²¾å‡†æ ¸ç®—ã€ä¼˜åŒ–ç»è¥ç®¡ç†ã€‚
ï¼ˆäºŒï¼‰éœ€æ±‚åˆ†æ
åŠŸèƒ½éœ€æ±‚ ï¼šç³»ç»Ÿåˆ’åˆ†ä¸ºäº”å¤§æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œåœºç‰©èµ„ç®¡ç†ä»¥åŠç³»ç»Ÿç®¡ç†ã€‚ä¸åŒç”¨æˆ·è§’è‰²äº«æœ‰ä¸åŒæƒé™ï¼Œå…¶ä¸­ï¼Œç®¡ç†å‘˜æ‹¥æœ‰ç³»ç»Ÿæœ€é«˜æƒé™ï¼Œè´Ÿè´£ç³»ç»Ÿå…¬å‘Šç®¡ç†ã€å†œåœºå‘˜å·¥ç®¡ç†ã€è§’è‰²æƒé™åˆ†é…ã€èœå•é…ç½®ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼›å†œåœºå‘˜å·¥åˆ™æ ¹æ®å„è‡ªè§’è‰²ï¼ˆé‡‡è´­äººå‘˜ã€é”€å”®äººå‘˜ã€å†œç”°ç®¡ç†äººå‘˜ï¼‰ä½¿ç”¨ç›¸åº”åŠŸèƒ½æ¨¡å—ï¼Œå¦‚ç‰©èµ„é‡‡è´­ã€åº“å­˜ç®¡ç†ã€å†œç”°ä¿¡æ¯æŸ¥çœ‹ç­‰ã€‚
æŠ€æœ¯å¯è¡Œæ€§åˆ†æ ï¼šå‰ç«¯é‡‡ç”¨ Vue.js + Element UI å®ç°å“åº”å¼ç•Œé¢ï¼Œåç«¯ä½¿ç”¨ Spring Boot æ„å»º RESTful APIï¼Œå®ç°å‰åç«¯è§£è€¦ã€‚ä½¿ç”¨ MySQL å­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼Œé€šè¿‡ MyBatis-Plus ç®€åŒ–æ•°æ®è®¿é—®ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®è¯»å†™ã€‚åŒæ—¶ï¼Œé›†æˆ ECharts å®ç°æ•°æ®å¯è§†åŒ–ï¼Œåˆ©ç”¨ WebSocket å®ç°å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œé‡‡ç”¨ JWT å®ç°ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†ã€‚
ï¼ˆä¸‰ï¼‰ç³»ç»Ÿè®¾è®¡
æŠ€æœ¯æ¶æ„ ï¼šé‡‡ç”¨ B/Sï¼ˆæµè§ˆå™¨ / æœåŠ¡å™¨ï¼‰ç»“æ„ï¼Œå‰ç«¯ä½¿ç”¨ Vue.js å¼€å‘ï¼Œé€šè¿‡ Axios å‘ Spring Boot åç«¯å‘é€ HTTP è¯·æ±‚ï¼Œåç«¯ä»¥ RESTful API æ¥å£å½¢å¼æä¾›æœåŠ¡ï¼Œè®¿é—® MySQL æ•°æ®åº“ï¼Œå®ç°ç³»ç»Ÿçš„é«˜å†…èšã€ä½è€¦åˆã€‚
å±‚æ¬¡ç»“æ„ ï¼šå‰ç«¯å±‚è´Ÿè´£ç”¨æˆ·äº¤äº’ä¸ç•Œé¢å±•ç¤ºï¼›åç«¯å±‚åˆ†ä¸ºæ§åˆ¶å™¨å±‚ã€æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚ã€å®ä½“å±‚å’Œé…ç½®å±‚ï¼›æ•°æ®åº“å±‚ç”¨äºå­˜å‚¨ç³»ç»Ÿæ•°æ®ï¼Œè®¾è®¡ 11 å¼ è¡¨ï¼Œé€šè¿‡å¤–é”®å…³è”å®ç°æ•°æ®è”åŠ¨ã€‚
ç”¨ä¾‹å»ºæ¨¡ ï¼šå›´ç»•åœ¨çº¿å®æ—¶ç®¡ç†å†œç”°è¿™ä¸€ä¸»é¢˜ï¼Œå°†ç³»ç»ŸåŠŸèƒ½åˆ’åˆ†ä¸ºäº”å¤§æ¨¡å—ï¼Œåˆ†åˆ«ä¸ºå†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ã€‚ä¸åŒè§’è‰²ç™»å½•åï¼Œå¯æ‰§è¡Œç›¸åº”æ“ä½œï¼Œå¦‚ç®¡ç†å‘˜å¯è¿›è¡Œç³»ç»Ÿå…¬å‘Šç®¡ç†ã€å†œåœºå‘˜å·¥ç®¡ç†ã€è§’è‰²æƒé™åˆ†é…ã€èœå•é…ç½®ç­‰æ“ä½œï¼Œå†œåœºå‘˜å·¥å¯æŸ¥çœ‹å†œåœºç³»ç»Ÿå…¬å‘Šã€å†œåœºç¯å¢ƒç›‘æµ‹ç»“æœå’Œå†œç”°åŸºæœ¬ä¿¡æ¯ç­‰ã€‚
ç³»ç»Ÿè¯¦ç»†è®¾è®¡ ï¼šæ˜ç¡®å„ç±»ç”¨æˆ·ï¼ˆå†œåœºç®¡ç†å‘˜ã€æ™®é€šå‘˜å·¥ï¼‰çš„ç™»å½•åŠæ“ä½œæµç¨‹ã€‚å†œåœºç®¡ç†å‘˜å¯æ“ä½œç³»ç»Ÿæ‰€æœ‰æ¨¡å—ï¼ŒåŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ï¼›æ™®é€šå‘˜å·¥ç™»å½•åï¼Œå¯å¯¹å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ç­‰æ¨¡å—è¿›è¡Œç®¡ç†ã€‚
ï¼ˆå››ï¼‰ç³»ç»Ÿå®ç°
å‰ç«¯å¼€å‘ ï¼šæŠ€æœ¯æ ˆä¸º Vue.js + Vue Router + Vuex + Element UI + Axiosã€‚å®ç°å…³é”®åŠŸèƒ½åŒ…æ‹¬åŠ¨æ€è·¯ç”±ï¼ˆæ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€åŠ è½½å¯è®¿é—®çš„èœå•è·¯ç”±ï¼Œå®ç°æƒé™éš”ç¦»ï¼‰ã€æ•°æ®å¯è§†åŒ–ï¼ˆä½¿ç”¨ ECharts ç»˜åˆ¶ç¯å¢ƒæ•°æ®æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰ï¼‰ã€æ–‡ä»¶æ“ä½œï¼ˆé€šè¿‡ Element UI çš„ Upload ç»„ä»¶å®ç° Excel æ–‡ä»¶å¯¼å…¥ï¼Œè°ƒç”¨ Blob å¯¹è±¡å®ç°æ•°æ®å¯¼å‡ºï¼‰ã€‚
åç«¯å¼€å‘ ï¼šæŠ€æœ¯æ ˆä¸º Spring Boot + MyBatis-Plus + MySQL + JWT + WebSocketã€‚å®ç°å…³é”®åŠŸèƒ½åŒ…æ‹¬æƒé™ç®¡ç†ï¼ˆé€šè¿‡ JwtInterceptor æ‹¦æˆªå™¨éªŒè¯ç”¨æˆ· Tokenï¼Œç»“åˆ RoleEnum æšä¸¾ç±»å®ç°è§’è‰²æƒé™æ§åˆ¶ï¼‰ã€æ•°æ®ç»Ÿè®¡ï¼ˆä½¿ç”¨ MyBatis-Plus çš„ Wrapper è¡¨è¾¾å¼å®ç°å¤æ‚æŸ¥è¯¢ï¼Œå¦‚æŒ‰æ—¶é—´ç»Ÿè®¡å†œç”°ç¯å¢ƒæ•°æ®å¹³å‡å€¼ï¼‰ã€å®æ—¶é€šä¿¡ï¼ˆé›†æˆ WebSocket å®ç°åº“å­˜é¢„è­¦ã€å…¬å‘Šæ¨é€ç­‰æ¶ˆæ¯çš„å®æ—¶é€šçŸ¥ï¼‰ã€‚
ï¼ˆäº”ï¼‰éƒ¨ç½²ä¸è¿è¡Œ
ç¯å¢ƒè¦æ±‚ ï¼šJDK 1.8+ã€Node.js 12+ã€MySQL 5.7+ã€Maven 3.6+ã€‚
å‰ç«¯éƒ¨ç½² ï¼šé€šè¿‡ git å…‹éš†é¡¹ç›®ï¼Œè¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–ï¼Œå¯å¯åŠ¨å¼€å‘æœåŠ¡å™¨æˆ–æ„å»ºç”Ÿäº§ç¯å¢ƒã€‚
åç«¯éƒ¨ç½² ï¼šè¿›å…¥åç«¯é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ Maven æ„å»ºé¡¹ç›®ï¼Œè¿è¡Œ JAR æ–‡ä»¶å³å¯ã€‚
ç³»ç»Ÿè¿è¡Œ ï¼šç”¨æˆ·ç™»å½•åï¼Œæ ¹æ®ä¸åŒè§’è‰²å¯æŸ¥çœ‹ä¸åŒé¡µé¢å’Œæƒé™ï¼Œç³»ç»Ÿä¸»è¦åŠŸèƒ½æ¨¡å—åŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†äº”å¤§æ¨¡å—ã€‚
ï¼ˆå…­ï¼‰é¡¹ç›®æˆæœä¸æ€»ç»“
é¡¹ç›®æˆåŠŸæ­å»ºäº†ä¸€ä¸ªé›†å®æ—¶ç›‘æµ‹ã€æ™ºèƒ½ç®¡ç†ç­‰åŠŸèƒ½äºä¸€ä½“çš„æ™ºæ…§å†œç”°ç®¡ç†å¹³å°ï¼Œå®ç°äº†å¯¹å†œç”°çš„å…¨æ–¹ä½æ™ºèƒ½åŒ–ç®¡ç†ï¼Œæœ‰æ•ˆæé«˜äº†å†œä¸šç”Ÿäº§æ•ˆç‡ã€èµ„æºåˆ©ç”¨ç‡ä»¥åŠå†œäº§å“è´¨é‡å®‰å…¨ï¼Œæ¨åŠ¨äº†å†œä¸šå¯æŒç»­å‘å±•ã€‚é¡¹ç›®ç»„æˆå‘˜åœ¨æŠ€æœ¯èƒ½åŠ›ã€å›¢é˜Ÿåä½œä¸ç®¡ç†ç­‰æ–¹é¢å‡å–å¾—äº†æ˜¾è‘—æˆé•¿ï¼Œä¸ºæœªæ¥åœ¨æ™ºæ…§å†œä¸šé¢†åŸŸçš„è¿›ä¸€æ­¥å‘å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚
äºŒã€AI è®²è§£å‘å¯¼æç¤ºè¯
ï¼ˆä¸€ï¼‰é¡¹ç›®ä»‹ç»
è¯·ç®€è¦ä»‹ç»æ™ºæ…§å†œç”°ç®¡ç†å¹³å°é¡¹ç›®èƒŒæ™¯ã€‚
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°é¡¹ç›®æ—¨åœ¨åº”å¯¹å…¨çƒäººå£å¢é•¿å’Œç²®é£Ÿéœ€æ±‚å¢åŠ çš„æŒ‘æˆ˜ï¼Œä¼ ç»Ÿå†œç”°ç®¡ç†æ–¹å¼æ•ˆç‡ä½ï¼Œéš¾ä»¥æ»¡è¶³ç°ä»£å†œä¸šå‘å±•éœ€æ±‚ã€‚æ™ºæ…§å†œç”°å»ºè®¾æˆä¸ºæå‡å†œä¸šç”Ÿäº§æ•ˆç‡ã€é™ä½ç”Ÿäº§æˆæœ¬ã€èŠ‚çº¦èµ„æºã€ä¿æŠ¤ç¯å¢ƒçš„æœ‰æ•ˆé€”å¾„ï¼Œå…·æœ‰æ˜¾è‘—çš„ç»æµæ•ˆç›Šå’Œç¤¾ä¼šæ•ˆç›Šã€‚
æœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ
é€šè¿‡å¼€å‘æ™ºæ…§å†œç”°ç®¡ç†å¹³å°ï¼Œå®ç°å¯¹å†œç”°çš„å®æ—¶ç›‘æµ‹ï¼Œè·å–ç¯å¢ƒæ•°æ®ã€ä½œç‰©ç”Ÿé•¿ä¿¡æ¯ç­‰å…³é”®æŒ‡æ ‡ï¼›æä¾›é«˜æ•ˆçš„å†œç”°ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†œç”°ä¿¡æ¯ç®¡ç†ã€ç¯å¢ƒç›‘æµ‹ã€è§†é¢‘ç›‘æ§ç­‰ï¼›å®ç°ç²¾å‡†çš„å†³ç­–æ”¯æŒï¼Œé€šè¿‡æ•°æ®åˆ†æä¸ºå†œæˆ·æä¾›ç§‘å­¦çš„ç”Ÿäº§å»ºè®®ï¼›æ¨åŠ¨å†œä¸šå¯æŒç»­å‘å±•ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ï¼Œé™ä½èµ„æºæµªè´¹ï¼Œä¿éšœå†œäº§å“è´¨é‡å®‰å…¨ã€‚
ï¼ˆäºŒï¼‰éœ€æ±‚åˆ†æ
è¯·é˜è¿°æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„åŠŸèƒ½éœ€æ±‚ã€‚
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„åŠŸèƒ½éœ€æ±‚æ¶µç›–äº”å¤§æ ¸å¿ƒæ¨¡å—ã€‚å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥æ¨¡å—ç”¨äºå±•ç¤ºç³»ç»Ÿé€šçŸ¥ï¼Œå¦‚å¤©æ°”é¢„è­¦ã€ç—…è™«å®³é˜²æ²»çŸ¥è¯†ï¼Œæ”¯æŒç®¡ç†å‘˜å‘å¸ƒã€ç¼–è¾‘ã€åˆ é™¤å…¬å‘Šã€‚å†œåœºç»Ÿè®¡åˆ†ææ¨¡å—åŒ…æ‹¬ç¯å¢ƒç›‘æµ‹ï¼Œå®æ—¶å±•ç¤ºå…‰ç…§å¼ºåº¦ã€æ¸©åº¦ã€æ¹¿åº¦ã€åœŸå£¤ pH å€¼ç­‰æ•°æ®ï¼Œå¹¶é€šè¿‡ ECharts ç”Ÿæˆè¶‹åŠ¿å›¾è¡¨ï¼ŒåŒæ—¶æ¥å…¥å†œç”°æ‘„åƒå¤´å®ç°è¿œç¨‹å®æ—¶ç”»é¢æŸ¥çœ‹ã€‚å†œç”°ç®¡ç†æ¨¡å—æ”¯æŒå†œç”°ä¿¡æ¯çš„æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤åŠæ‰¹é‡æ“ä½œï¼Œå¯å¯¼å‡º Excel æ•°æ®ï¼ŒæŸ¥çœ‹å•å—å†œç”°çš„ä½œç‰©ç”Ÿé•¿çŠ¶æ€ã€ç¯å¢ƒå‚æ•°ç­‰è¯¦æƒ…ã€‚å†œèµ„ç®¡ç†æ¨¡å—åŒ…å«ç‰©èµ„é‡‡è´­ï¼Œè®°å½•åŒ–è‚¥ã€é™¤è‰å‰‚ç­‰ç‰©èµ„çš„é‡‡è´­è®°å½•ï¼Œæ”¯æŒ Excel å¯¼å…¥ / å¯¼å‡ºï¼Œä»¥åŠåº“å­˜ç®¡ç†ï¼Œå®æ—¶è·Ÿè¸ªç‰©èµ„åº“å­˜æ•°é‡ï¼Œä½åº“å­˜è‡ªåŠ¨é¢„è­¦ï¼Œè¿˜æœ‰å†œä½œç‰©å‡ºå”®ç®¡ç†å†œäº§å“é”€å”®è®°å½•ï¼Œç»Ÿè®¡é”€å”®æ¸ é“ä¸æ”¶ç›Šã€‚ç³»ç»Ÿç®¡ç†æ¨¡å—åˆ™æ¶‰åŠå‘˜å·¥ç®¡ç†ï¼Œç»´æŠ¤å‘˜å·¥è´¦å·ä¿¡æ¯ï¼Œåˆ†é…è§’è‰²ï¼Œè§’è‰²æƒé™é…ç½®é€šè¿‡ RBAC æ¨¡å‹å®ç°ç»†ç²’åº¦è®¿é—®æ§åˆ¶ï¼Œèœå•ç®¡ç†æ”¯æŒåŠ¨æ€è°ƒæ•´ç³»ç»ŸåŠŸèƒ½èœå•ï¼Œä»¥åŠå³æ—¶é€šè®¯åŠŸèƒ½ï¼Œå®ç°æ¶ˆæ¯çš„å®æ—¶æ¨é€ã€å†å²æ¶ˆæ¯æŸ¥è¯¢ã€ç¾¤ç»„èŠå¤©ç­‰ã€‚
è¯¥é¡¹ç›®çš„æŠ€æœ¯å¯è¡Œæ€§åˆ†ææ˜¯æ€æ ·çš„ï¼Ÿ
å‰ç«¯é‡‡ç”¨ Vue.js + Element UI å®ç°å“åº”å¼ç•Œé¢ï¼Œåç«¯ä½¿ç”¨ Spring Boot æ„å»º RESTful APIï¼Œå®ç°å‰åç«¯è§£è€¦ã€‚ä½¿ç”¨ MySQL å­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼Œé€šè¿‡ MyBatis-Plus ç®€åŒ–æ•°æ®è®¿é—®ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®è¯»å†™ã€‚é›†æˆ ECharts å®ç°æ•°æ®å¯è§†åŒ–ï¼Œåˆ©ç”¨ WebSocket å®ç°å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œé‡‡ç”¨ JWT å®ç°ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†ï¼Œè¿™äº›æŠ€æœ¯é€‰å‹ç¡®ä¿äº†é¡¹ç›®çš„å¯è¡Œæ€§å’Œå¯å®æ–½æ€§ã€‚
ï¼ˆä¸‰ï¼‰ç³»ç»Ÿè®¾è®¡
è¯·æè¿°æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„æŠ€æœ¯æ¶æ„ã€‚
é‡‡ç”¨ B/Sï¼ˆæµè§ˆå™¨ / æœåŠ¡å™¨ï¼‰ç»“æ„ï¼Œå‰ç«¯ä½¿ç”¨ Vue.js å¼€å‘ï¼Œé€šè¿‡ Axios å‘ Spring Boot åç«¯å‘é€ HTTP è¯·æ±‚ï¼Œåç«¯ä»¥ RESTful API æ¥å£å½¢å¼æä¾›æœåŠ¡ï¼Œè®¿é—® MySQL æ•°æ®åº“ï¼Œå®ç°ç³»ç»Ÿçš„é«˜å†…èšã€ä½è€¦åˆã€‚
å±‚æ¬¡ç»“æ„ ï¼šå‰ç«¯å±‚è´Ÿè´£ç”¨æˆ·äº¤äº’ä¸ç•Œé¢å±•ç¤ºï¼›åç«¯å±‚åˆ†ä¸ºæ§åˆ¶å™¨å±‚ã€æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚ã€å®ä½“å±‚å’Œé…ç½®å±‚ï¼›æ•°æ®åº“å±‚ç”¨äºå­˜å‚¨ç³»ç»Ÿæ•°æ®ï¼Œè®¾è®¡ 11 å¼ è¡¨ï¼Œé€šè¿‡å¤–é”®å…³è”å®ç°æ•°æ®è”åŠ¨ã€‚
ç”¨ä¾‹å»ºæ¨¡ ï¼šå›´ç»•åœ¨çº¿å®æ—¶ç®¡ç†å†œç”°è¿™ä¸€ä¸»é¢˜ï¼Œå°†ç³»ç»ŸåŠŸèƒ½åˆ’åˆ†ä¸ºäº”å¤§æ¨¡å—ï¼Œåˆ†åˆ«ä¸ºå†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ã€‚ä¸åŒè§’è‰²ç™»å½•åï¼Œå¯æ‰§è¡Œç›¸åº”æ“ä½œï¼Œå¦‚ç®¡ç†å‘˜å¯è¿›è¡Œç³»ç»Ÿå…¬å‘Šç®¡ç†ã€å†œåœºå‘˜å·¥ç®¡ç†ã€è§’è‰²æƒé™åˆ†é…ã€èœå•é…ç½®ç­‰æ“ä½œï¼Œå†œåœºå‘˜å·¥å¯æŸ¥çœ‹å†œåœºç³»ç»Ÿå…¬å‘Šã€å†œåœºç¯å¢ƒç›‘æµ‹ç»“æœå’Œå†œç”°åŸºæœ¬ä¿¡æ¯ç­‰ã€‚
ç³»ç»Ÿè¯¦ç»†è®¾è®¡ ï¼šæ˜ç¡®å„ç±»ç”¨æˆ·ï¼ˆå†œåœºç®¡ç†å‘˜ã€æ™®é€šå‘˜å·¥ï¼‰çš„ç™»å½•åŠæ“ä½œæµç¨‹ã€‚å†œåœºç®¡ç†å‘˜å¯æ“ä½œç³»ç»Ÿæ‰€æœ‰æ¨¡å—ï¼ŒåŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ï¼›æ™®é€šå‘˜å·¥ç™»å½•åï¼Œå¯å¯¹å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ç­‰æ¨¡å—è¿›è¡Œç®¡ç†ã€‚
ï¼ˆå››ï¼‰ç³»ç»Ÿå®ç°
å‰ç«¯å¼€å‘ ï¼šæŠ€æœ¯æ ˆä¸º Vue.js + Vue Router + Vuex + Element UI + Axiosã€‚å®ç°å…³é”®åŠŸèƒ½åŒ…æ‹¬åŠ¨æ€è·¯ç”±ï¼ˆæ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€åŠ è½½å¯è®¿é—®çš„èœå•è·¯ç”±ï¼Œå®ç°æƒé™éš”ç¦»ï¼‰ã€æ•°æ®å¯è§†åŒ–ï¼ˆä½¿ç”¨ ECharts ç»˜åˆ¶ç¯å¢ƒæ•°æ®æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰ï¼‰ã€æ–‡ä»¶æ“ä½œï¼ˆé€šè¿‡ Element UI çš„ Upload ç»„ä»¶å®ç° Excel æ–‡ä»¶å¯¼å…¥ï¼Œè°ƒç”¨ Blob å¯¹è±¡å®ç°æ•°æ®å¯¼å‡ºï¼‰ã€‚
åç«¯å¼€å‘ ï¼šæŠ€æœ¯æ ˆä¸º Spring Boot + MyBatis-Plus + MySQL + JWT + WebSocketã€‚å®ç°å…³é”®åŠŸèƒ½åŒ…æ‹¬æƒé™ç®¡ç†ï¼ˆé€šè¿‡ JwtInterceptor æ‹¦æˆªå™¨éªŒè¯ç”¨æˆ· Tokenï¼Œç»“åˆ RoleEnum æšä¸¾ç±»å®ç°è§’è‰²æƒé™æ§åˆ¶ï¼‰ã€æ•°æ®ç»Ÿè®¡ï¼ˆä½¿ç”¨ MyBatis-Plus çš„ Wrapper è¡¨è¾¾å¼å®ç°å¤æ‚æŸ¥è¯¢ï¼Œå¦‚æŒ‰æ—¶é—´ç»Ÿè®¡å†œç”°ç¯å¢ƒæ•°æ®å¹³å‡å€¼ï¼‰ã€å®æ—¶é€šä¿¡ï¼ˆé›†æˆ WebSocket å®ç°åº“å­˜é¢„è­¦ã€å…¬å‘Šæ¨é€ç­‰æ¶ˆæ¯çš„å®æ—¶é€šçŸ¥ï¼‰ã€‚
ï¼ˆäº”ï¼‰éƒ¨ç½²ä¸è¿è¡Œ
ç¯å¢ƒè¦æ±‚ ï¼šJDK 1.8+ã€Node.js 12+ã€MySQL 5.7+ã€Maven 3.6+ã€‚
å‰ç«¯éƒ¨ç½² ï¼šé€šè¿‡ git å…‹éš†é¡¹ç›®ï¼Œè¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–ï¼Œå¯å¯åŠ¨å¼€å‘æœåŠ¡å™¨æˆ–æ„å»ºç”Ÿäº§ç¯å¢ƒã€‚
åç«¯éƒ¨ç½² ï¼šè¿›å…¥åç«¯é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ Maven æ„å»ºé¡¹ç›®ï¼Œè¿è¡Œ JAR æ–‡ä»¶å³å¯ã€‚
ç³»ç»Ÿè¿è¡Œ ï¼šç”¨æˆ·ç™»å½•åï¼Œæ ¹æ®ä¸åŒè§’è‰²å¯æŸ¥çœ‹ä¸åŒé¡µé¢å’Œæƒé™ï¼Œç³»ç»Ÿä¸»è¦åŠŸèƒ½æ¨¡å—åŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†äº”å¤§æ¨¡å—ã€‚
ï¼ˆå…­ï¼‰é¡¹ç›®æˆæœä¸æ€»ç»“
é¡¹ç›®æˆåŠŸæ­å»ºäº†ä¸€ä¸ªé›†å®æ—¶ç›‘æµ‹ã€æ™ºèƒ½ç®¡ç†ç­‰åŠŸèƒ½äºä¸€ä½“çš„æ™ºæ…§å†œç”°ç®¡ç†å¹³å°ï¼Œå®ç°äº†å¯¹å†œç”°çš„å…¨æ–¹ä½æ™ºèƒ½åŒ–ç®¡ç†ï¼Œæœ‰æ•ˆæé«˜äº†å†œä¸šç”Ÿäº§æ•ˆç‡ã€èµ„æºåˆ©ç”¨ç‡ä»¥åŠå†œäº§å“è´¨é‡å®‰å…¨ï¼Œæ¨åŠ¨äº†å†œä¸šå¯æŒç»­å‘å±•ã€‚é¡¹ç›®ç»„æˆå‘˜åœ¨æŠ€æœ¯èƒ½åŠ›ã€å›¢é˜Ÿåä½œä¸ç®¡ç†ç­‰æ–¹é¢å‡å–å¾—äº†æ˜¾è‘—æˆé•¿ï¼Œä¸ºæœªæ¥åœ¨æ™ºæ…§å†œä¸šé¢†åŸŸçš„è¿›ä¸€æ­¥å‘å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚
äºŒã€AI è®²è§£å‘å¯¼æç¤ºè¯
ï¼ˆä¸€ï¼‰é¡¹ç›®ä»‹ç»
è¯·ç®€è¦ä»‹ç»æ™ºæ…§å†œç”°ç®¡ç†å¹³å°é¡¹ç›®èƒŒæ™¯ã€‚
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°é¡¹ç›®æ—¨åœ¨åº”å¯¹å…¨çƒäººå£å¢é•¿å’Œç²®é£Ÿéœ€æ±‚å¢åŠ çš„æŒ‘æˆ˜ï¼Œä¼ ç»Ÿå†œç”°ç®¡ç†æ–¹å¼æ•ˆç‡ä½ï¼Œéš¾ä»¥æ»¡è¶³ç°ä»£å†œä¸šå‘å±•éœ€æ±‚ã€‚æ™ºæ…§å†œç”°å»ºè®¾æˆä¸ºæå‡å†œä¸šç”Ÿäº§æ•ˆç‡ã€é™ä½ç”Ÿäº§æˆæœ¬ã€èŠ‚çº¦èµ„æºã€ä¿æŠ¤ç¯å¢ƒçš„æœ‰æ•ˆé€”å¾„ï¼Œå…·æœ‰æ˜¾è‘—çš„ç»æµæ•ˆç›Šå’Œç¤¾ä¼šæ•ˆç›Šã€‚
æœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ
é€šè¿‡å¼€å‘æ™ºæ…§å†œç”°ç®¡ç†å¹³å°ï¼Œå®ç°å¯¹å†œç”°çš„å®æ—¶ç›‘æµ‹ï¼Œè·å–ç¯å¢ƒæ•°æ®ã€ä½œç‰©ç”Ÿé•¿ä¿¡æ¯ç­‰å…³é”®æŒ‡æ ‡ï¼›æä¾›é«˜æ•ˆçš„å†œç”°ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†œç”°ä¿¡æ¯ç®¡ç†ã€ç¯å¢ƒç›‘æµ‹ã€è§†é¢‘ç›‘æ§ç­‰ï¼›å®ç°ç²¾å‡†çš„å†³ç­–æ”¯æŒï¼Œé€šè¿‡æ•°æ®åˆ†æä¸ºå†œæˆ·æä¾›ç§‘å­¦çš„ç”Ÿäº§å»ºè®®ï¼›æ¨åŠ¨å†œä¸šå¯æŒç»­å‘å±•ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ï¼Œé™ä½èµ„æºæµªè´¹ï¼Œä¿éšœå†œäº§å“è´¨é‡å®‰å…¨ã€‚
ï¼ˆäºŒï¼‰éœ€æ±‚åˆ†æ
è¯·é˜è¿°æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„åŠŸèƒ½éœ€æ±‚ã€‚
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„åŠŸèƒ½éœ€æ±‚æ¶µç›–äº”å¤§æ ¸å¿ƒæ¨¡å—ã€‚å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥æ¨¡å—ç”¨äºå±•ç¤ºç³»ç»Ÿé€šçŸ¥ï¼Œå¦‚å¤©æ°”é¢„è­¦ã€ç—…è™«å®³é˜²æ²»çŸ¥è¯†ï¼Œæ”¯æŒç®¡ç†å‘˜å‘å¸ƒã€ç¼–è¾‘ã€åˆ é™¤å…¬å‘Šã€‚å†œåœºç»Ÿè®¡åˆ†ææ¨¡å—åŒ…æ‹¬ç¯å¢ƒç›‘æµ‹ï¼Œå®æ—¶å±•ç¤ºå…‰ç…§å¼ºåº¦ã€æ¸©åº¦ã€æ¹¿åº¦ã€åœŸå£¤ pH å€¼ç­‰æ•°æ®ï¼Œå¹¶é€šè¿‡ ECharts ç”Ÿæˆè¶‹åŠ¿å›¾è¡¨ï¼ŒåŒæ—¶æ¥å…¥å†œç”°æ‘„åƒå¤´å®ç°è¿œç¨‹å®æ—¶ç”»é¢æŸ¥çœ‹ã€‚å†œç”°ç®¡ç†æ¨¡å—æ”¯æŒå†œç”°ä¿¡æ¯çš„æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤åŠæ‰¹é‡æ“ä½œï¼Œå¯å¯¼å‡º Excel æ•°æ®ï¼ŒæŸ¥çœ‹å•å—å†œç”°çš„ä½œç‰©ç”Ÿé•¿çŠ¶æ€ã€ç¯å¢ƒå‚æ•°ç­‰è¯¦æƒ…ã€‚å†œèµ„ç®¡ç†æ¨¡å—åŒ…å«ç‰©èµ„é‡‡è´­ï¼Œè®°å½•åŒ–è‚¥ã€é™¤è‰å‰‚ç­‰ç‰©èµ„çš„é‡‡è´­è®°å½•ï¼Œæ”¯æŒ Excel å¯¼å…¥ / å¯¼å‡ºï¼Œä»¥åŠåº“å­˜ç®¡ç†ï¼Œå®æ—¶è·Ÿè¸ªç‰©èµ„åº“å­˜æ•°é‡ï¼Œä½åº“å­˜è‡ªåŠ¨é¢„è­¦ï¼Œè¿˜æœ‰å†œä½œç‰©å‡ºå”®ç®¡ç†å†œäº§å“é”€å”®è®°å½•ï¼Œç»Ÿè®¡é”€å”®æ¸ é“ä¸æ”¶ç›Šã€‚ç³»ç»Ÿç®¡ç†æ¨¡å—åˆ™æ¶‰åŠå‘˜å·¥ç®¡ç†ï¼Œç»´æŠ¤å‘˜å·¥è´¦å·ä¿¡æ¯ï¼Œåˆ†é…è§’è‰²ï¼Œè§’è‰²æƒé™é…ç½®é€šè¿‡ RBAC æ¨¡å‹å®ç°ç»†ç²’åº¦è®¿é—®æ§åˆ¶ï¼Œèœå•ç®¡ç†æ”¯æŒåŠ¨æ€è°ƒæ•´ç³»ç»ŸåŠŸèƒ½èœå•ï¼Œä»¥åŠå³æ—¶é€šè®¯åŠŸèƒ½ï¼Œå®ç°æ¶ˆæ¯çš„å®æ—¶æ¨é€ã€å†å²æ¶ˆæ¯æŸ¥è¯¢ã€ç¾¤ç»„èŠå¤©ç­‰ã€‚
è¯¥é¡¹ç›®çš„æŠ€æœ¯å¯è¡Œæ€§åˆ†ææ˜¯æ€æ ·çš„ï¼Ÿ
å‰ç«¯é‡‡ç”¨ Vue.js + Element UI å®ç°å“åº”å¼ç•Œé¢ï¼Œåç«¯ä½¿ç”¨ Spring Boot æ„å»º RESTful APIï¼Œå®ç°å‰åç«¯è§£è€¦ã€‚ä½¿ç”¨ MySQL å­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼Œé€šè¿‡ MyBatis-Plus ç®€åŒ–æ•°æ®è®¿é—®ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ•°æ®è¯»å†™ã€‚é›†æˆ ECharts å®ç°æ•°æ®å¯è§†åŒ–ï¼Œåˆ©ç”¨ WebSocket å®ç°å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œé‡‡ç”¨ JWT å®ç°ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†ï¼Œè¿™äº›æŠ€æœ¯é€‰å‹ç¡®ä¿äº†é¡¹ç›®çš„å¯è¡Œæ€§å’Œå¯å®æ–½æ€§ã€‚
ï¼ˆä¸‰ï¼‰ç³»ç»Ÿè®¾è®¡
è¯·æè¿°æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„æŠ€æœ¯æ¶æ„ã€‚
é‡‡ç”¨ B/Sï¼ˆæµè§ˆå™¨ / æœåŠ¡å™¨ï¼‰ç»“æ„ï¼Œå‰ç«¯ä½¿ç”¨ Vue.js å¼€å‘ï¼Œé€šè¿‡ Axios å‘ Spring Boot åç«¯å‘é€ HTTP è¯·æ±‚ï¼Œåç«¯ä»¥ RESTful API æ¥å£å½¢å¼æä¾›æœåŠ¡ï¼Œè®¿é—® MySQL æ•°æ®åº“ï¼Œå®ç°ç³»ç»Ÿçš„é«˜å†…èšã€ä½è€¦åˆã€‚
å±‚æ¬¡ç»“æ„ ï¼šå‰ç«¯å±‚è´Ÿè´£ç”¨æˆ·äº¤äº’ä¸ç•Œé¢å±•ç¤ºï¼›åç«¯å±‚åˆ†ä¸ºæ§åˆ¶å™¨å±‚ã€æœåŠ¡å±‚ã€æ•°æ®è®¿é—®å±‚ã€å®ä½“å±‚å’Œé…ç½®å±‚ï¼›æ•°æ®åº“å±‚ç”¨äºå­˜å‚¨ç³»ç»Ÿæ•°æ®ï¼Œè®¾è®¡ 11 å¼ è¡¨ï¼Œé€šè¿‡å¤–é”®å…³è”å®ç°æ•°æ®è”åŠ¨ã€‚
ç”¨ä¾‹å»ºæ¨¡ ï¼šå›´ç»•åœ¨çº¿å®æ—¶ç®¡ç†å†œç”°è¿™ä¸€ä¸»é¢˜ï¼Œå°†ç³»ç»ŸåŠŸèƒ½åˆ’åˆ†ä¸ºäº”å¤§æ¨¡å—ï¼Œåˆ†åˆ«ä¸ºå†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ã€‚ä¸åŒè§’è‰²ç™»å½•åï¼Œå¯æ‰§è¡Œç›¸åº”æ“ä½œï¼Œå¦‚ç®¡ç†å‘˜å¯è¿›è¡Œç³»ç»Ÿå…¬å‘Šç®¡ç†ã€å†œåœºå‘˜å·¥ç®¡ç†ã€è§’è‰²æƒé™åˆ†é…ã€èœå•é…ç½®ç­‰æ“ä½œï¼Œå†œåœºå‘˜å·¥å¯æŸ¥çœ‹å†œåœºç³»ç»Ÿå…¬å‘Šã€å†œåœºç¯å¢ƒç›‘æµ‹ç»“æœå’Œå†œç”°åŸºæœ¬ä¿¡æ¯ç­‰ã€‚
ç³»ç»Ÿè¯¦ç»†è®¾è®¡ ï¼šæ˜ç¡®å„ç±»ç”¨æˆ·ï¼ˆå†œåœºç®¡ç†å‘˜ã€æ™®é€šå‘˜å·¥ï¼‰çš„ç™»å½•åŠæ“ä½œæµç¨‹ã€‚å†œåœºç®¡ç†å‘˜å¯æ“ä½œç³»ç»Ÿæ‰€æœ‰æ¨¡å—ï¼ŒåŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ï¼›æ™®é€šå‘˜å·¥ç™»å½•åï¼Œå¯å¯¹å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ç­‰æ¨¡å—è¿›è¡Œç®¡ç†ã€‚
ï¼ˆå››ï¼‰ç³»ç»Ÿå®ç°
å‰ç«¯å¼€å‘ ï¼šæŠ€æœ¯æ ˆä¸º Vue.js + Vue Router + Vuex + Element UI + Axiosã€‚å®ç°å…³é”®åŠŸèƒ½åŒ…æ‹¬åŠ¨æ€è·¯ç”±ï¼ˆæ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€åŠ è½½å¯è®¿é—®çš„èœå•è·¯ç”±ï¼Œå®ç°æƒé™éš”ç¦»ï¼‰ã€æ•°æ®å¯è§†åŒ–ï¼ˆä½¿ç”¨ ECharts ç»˜åˆ¶ç¯å¢ƒæ•°æ®æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰ï¼‰ã€æ–‡ä»¶æ“ä½œï¼ˆé€šè¿‡ Element UI çš„ Upload ç»„ä»¶å®ç° Excel æ–‡ä»¶å¯¼å…¥ï¼Œè°ƒç”¨ Blob å¯¹è±¡å®ç°æ•°æ®å¯¼å‡ºï¼‰ã€‚
åç«¯å¼€å‘ ï¼šæŠ€æœ¯æ ˆä¸º Spring Boot + MyBatis-Plus + MySQL + JWT + WebSocketã€‚å®ç°å…³é”®åŠŸèƒ½åŒ…æ‹¬æƒé™ç®¡ç†ï¼ˆé€šè¿‡ JwtInterceptor æ‹¦æˆªå™¨éªŒè¯ç”¨æˆ· Tokenï¼Œç»“åˆ RoleEnum æšä¸¾ç±»å®ç°è§’è‰²æƒé™æ§åˆ¶ï¼‰ã€æ•°æ®ç»Ÿè®¡ï¼ˆä½¿ç”¨ MyBatis-Plus çš„ Wrapper è¡¨è¾¾å¼å®ç°å¤æ‚æŸ¥è¯¢ï¼Œå¦‚æŒ‰æ—¶é—´ç»Ÿè®¡å†œç”°ç¯å¢ƒæ•°æ®å¹³å‡å€¼ï¼‰ã€å®æ—¶é€šä¿¡ï¼ˆé›†æˆ WebSocket å®ç°å®æ—¶é€šçŸ¥ï¼Œå¦‚åº“å­˜é¢„è­¦ã€å…¬å‘Šæ¨é€ç­‰æ¶ˆæ¯ï¼‰ã€‚
ï¼ˆäº”ï¼‰éƒ¨ç½²ä¸è¿è¡Œ
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°çš„éƒ¨ç½²ç¯å¢ƒè¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ
éœ€è¦ JDK 1.8+ã€Node.js 12+ã€MySQL 5.7+ã€Maven 3.6+ã€‚
å¦‚ä½•è¿›è¡Œå‰ç«¯å’Œåç«¯çš„éƒ¨ç½²ï¼Ÿ
å‰ç«¯éƒ¨ç½²ï¼šé€šè¿‡ git å…‹éš†é¡¹ç›®ï¼Œè¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½•ï¼Œå®‰è£…ä¾èµ–ï¼Œä½¿ç”¨ npm run serve å¯åŠ¨å¼€å‘æœåŠ¡å™¨æˆ– npm run build æ„å»ºç”Ÿäº§ç¯å¢ƒã€‚åç«¯éƒ¨ç½²ï¼šè¿›å…¥åç«¯é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ Maven æ„å»ºé¡¹ç›®ï¼Œé€šè¿‡ java -jar target/smartfarm-0.0.1-SNAPSHOT.jar è¿è¡Œ JAR æ–‡ä»¶ã€‚
ç³»ç»Ÿè¿è¡Œæ—¶ï¼Œä¸åŒè§’è‰²ç”¨æˆ·åˆ†åˆ«èƒ½çœ‹åˆ°å“ªäº›åŠŸèƒ½æ¨¡å—ï¼Ÿ
ç”¨æˆ·ç™»å½•åï¼Œç®¡ç†å‘˜å¯ç®¡ç†ç³»ç»Ÿæ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ã€ç³»ç»Ÿç®¡ç†ï¼›æ™®é€šå‘˜å·¥å¯æŸ¥çœ‹å†œåœºä¸»é¡µç³»ç»Ÿå…¬å‘Šé€šçŸ¥ã€å†œåœºç»Ÿè®¡åˆ†æã€å†œç”°ç®¡ç†ã€å†œä½œç‰©èµ„ç®¡ç†ç­‰æ¨¡å—ï¼Œå…·ä½“åŠŸèƒ½å–å†³äºå…¶è§’è‰²æƒé™ã€‚
ï¼ˆå…­ï¼‰é¡¹ç›®æˆæœä¸æ€»ç»“
æ™ºæ…§å†œç”°ç®¡ç†å¹³å°å–å¾—äº†å“ªäº›æˆæœï¼Ÿ
æˆåŠŸæ­å»ºäº†ä¸€ä¸ªé›†å®æ—¶ç›‘æµ‹ã€æ™ºèƒ½ç®¡ç†ç­‰åŠŸèƒ½äºä¸€ä½“çš„æ™ºæ…§å†œç”°ç®¡ç†å¹³å°ï¼Œå®ç°äº†å¯¹å†œç”°çš„å…¨æ–¹ä½æ™ºèƒ½åŒ–ç®¡ç†ï¼Œæœ‰æ•ˆæé«˜äº†å†œä¸šç”Ÿäº§æ•ˆç‡ã€èµ„æºåˆ©ç”¨ç‡ä»¥åŠå†œäº§å“è´¨é‡å®‰å…¨ï¼Œæ¨åŠ¨äº†å†œä¸šå¯æŒç»­å‘å±•ã€‚
é¡¹ç›®ç»„æˆå‘˜åœ¨é¡¹ç›®ä¸­æœ‰å“ªäº›æ”¶è·å’Œæˆé•¿ï¼Ÿ
é¡¹ç›®ç»„æˆå‘˜åœ¨æŠ€æœ¯èƒ½åŠ›ã€å›¢é˜Ÿåä½œä¸ç®¡ç†ç­‰æ–¹é¢å‡å–å¾—äº†æ˜¾è‘—æˆé•¿ã€‚ä¾‹å¦‚ï¼Œè¿é€šåœ¨æŠ€æœ¯ä¸Šä¸»å¯¼å¼€å‘æº¯æºç ç”Ÿæˆç³»ç»Ÿï¼ŒæŒæ¡äº†å‰åç«¯å¼€å‘æŠ€èƒ½ï¼Œå›¢é˜Ÿåä½œä¸Šä½œä¸ºç»„é•¿ç»Ÿç­¹è§„åˆ’é¡¹ç›®ï¼Œåˆç†åˆ†é…ä»»åŠ¡ï¼Œæ¿€å‘å›¢é˜Ÿæˆå‘˜ç§¯ææ€§ï¼›ææ¶µå®ç°äº†ä»å•çº¯æŠ€æœ¯å¼€å‘åˆ°ä¸šåŠ¡ + æŠ€æœ¯åŒé©±åŠ¨çš„æ€ç»´è½¬å˜ï¼ŒæŒæ¡äº†å†œä¸šç‰©è”ç½‘ç³»ç»Ÿå…¨æµç¨‹å¼€å‘ç»éªŒï¼›èŒƒé¾™é£ç³»ç»ŸæŒæ¡äº† Spring Boot + Vue å…¨æ ˆå¼€å‘æŠ€æœ¯æ ˆï¼Œåœ¨ JWT é‰´æƒã€MyBatis-Plus åŠ¨æ€ SQLã€ECharts æ•°æ®å¯è§†åŒ–ç­‰å…³é”®æŠ€æœ¯ä¸Šæœ‰æ˜¾è‘—æå‡ï¼›å®‰å¶ç£Šå­¦ä¹ äº†å¾®ä¿¡å°ç¨‹åºå¼€å‘å…¨æµç¨‹ï¼ŒæŒæ¡äº† JavaScript æ ¸å¿ƒç‰¹æ€§ï¼Œå®è·µäº†å‰åç«¯åˆ†ç¦»æ¶æ„ç­‰ã€‚
å¯¹é¡¹ç›®çš„æœªæ¥å±•æœ›æ˜¯ä»€ä¹ˆï¼Ÿ
æœªæ¥å°†è¿›ä¸€æ­¥ä¼˜åŒ–å’Œæ‹“å±•ç³»ç»ŸåŠŸèƒ½ï¼Œå¦‚åœ¨ç»Ÿè®¡åˆ†æåŠŸèƒ½ä¸Šè¿›è¡Œä¼˜åŒ–ä»¥æä¾›æ›´ç²¾å‡†çš„å†³ç­–æ”¯æŒï¼Œé›†æˆ AI æŠ€æœ¯æé«˜ç³»ç»Ÿæ™ºèƒ½åŒ–æ°´å¹³ï¼Œåˆ©ç”¨åŒºå—é“¾æŠ€æœ¯å»ºç«‹å†œäº§å“æº¯æºç³»ç»Ÿï¼Œå¼€å‘ç§»åŠ¨ç«¯åº”ç”¨æ–¹ä¾¿å†œæ°‘éšæ—¶éšåœ°ç®¡ç†å†œç”°ï¼Œé›†æˆæ›´å¤šç‰©è”ç½‘è®¾å¤‡å®ç°æ›´å…¨é¢çš„å†œç”°ç›‘æµ‹å’Œæ§åˆ¶ï¼Œæå‡ç³»ç»Ÿçš„å¤§æ•°æ®åˆ†æèƒ½åŠ›ç­‰ï¼ŒæŒç»­æ¨åŠ¨æ™ºæ…§å†œä¸šçš„å‘å±•ã€‚
`;
                // æ£€æŸ¥æ˜¯å¦éœ€è¦æ³¨å…¥æ•°æ®åº“å†…å®¹
                if (state.shouldInjectDatabase && databaseContent) {
                    systemPrompt += `\n\nã€æœ€æ–°æ•°æ®åº“å†…å®¹ã€‘\n${databaseContent}`;
                    state.shouldInjectDatabase = false; // ä½¿ç”¨åç«‹å³é‡ç½®æ ‡å¿—
                }

                if (knowledgeResults.length > 0) {
                    systemPrompt += '\n\nä»¥ä¸‹æ˜¯ç›¸å…³çš„å†œä¸šçŸ¥è¯†ï¼š\n' + knowledgeResults.join('\n');
                }

                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer sk-0ee13d616bf34ab6b73bedfd4fb3ad54',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: message }
                        ],
                        max_tokens: 1000
                    })
                });
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('DeepSeek API Error:', error);
                showNotification('AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨', 'error');
                return 'æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ã€‚å¦‚æœæ‚¨æœ‰å†œä¸šç›¸å…³é—®é¢˜ï¼Œæˆ‘ä¼šå°½åŠ›ä¸ºæ‚¨è§£ç­”ã€‚';
            }
        }

        // Emotional Analysis
        async function analyzeEmotion(message) {
            try {
                const response = await sendToDeepSeek(`åˆ†æä»¥ä¸‹æ¶ˆæ¯çš„æƒ…æ„Ÿå€¾å‘ï¼Œè¿”å›"å¼€å¿ƒ"ã€"å¥½å¥‡"æˆ–"æ‚²ä¼¤"ï¼š${message}`);
                return response.toLowerCase().includes('å¼€å¿ƒ') ? 'Happy' :
                       response.toLowerCase().includes('å¥½å¥‡') ? 'Curious' : 'Sad';
            } catch (error) {
                console.error('Emotion Analysis Error:', error);
                return 'Happy';
            }
        }

        // Email Service (Mocked)
        function sendEmail(to, subject, body) {
            showNotification(`æ¨¡æ‹Ÿå‘é€é‚®ä»¶è‡³ ${to}: ${subject}`);
            return true;
        }

        // Speech Recognition
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                state.speechRecognition = new SpeechRecognition();
                state.speechRecognition.lang = 'zh-CN';
                state.speechRecognition.interimResults = true;
                state.speechRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('message-input').value = transcript;
                    if (event.results[0].isFinal) {
                        sendMessage(transcript);
                    }
                };
                state.speechRecognition.onend = () => {
                    state.isVoiceActive = false;
                    document.getElementById('voice-waves').classList.add('hidden');
                    document.getElementById('mic-icon').classList.remove('hidden');
                    updateStatusPanel();
                };
                state.speechRecognition.onerror = () => {
                    showNotification('è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    state.isVoiceActive = false;
                    document.getElementById('voice-waves').classList.add('hidden');
                    document.getElementById('mic-icon').classList.remove('hidden');
                    updateStatusPanel();
                };
            } else {
                showNotification('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«', 'error');
            }
        }

        function toggleVoiceRecognition() {
            if (state.speechRecognition) {
                if (state.isVoiceActive) {
                    state.speechRecognition.stop();
                } else {
                    state.isVoiceActive = true;
                    document.getElementById('voice-waves').classList.remove('hidden');
                    document.getElementById('mic-icon').classList.add('hidden');
                    state.speechRecognition.start();
                    updateStatusPanel();
                }
            }
        }

        // Text-to-Speech
        function speak(text) {
            if (state.ttsEnabled) {
                // æ¸…ç†æ–‡æœ¬ä¸­çš„è¡¨æƒ…ç¬¦å·
                const cleanText = text.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu, '');

                // ä½¿ç”¨Web Speech API
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'zh-CN';

                // æ”¹è¿›è¯­éŸ³å‚æ•°
                utterance.rate = 1.0; // è¯­é€Ÿ
                utterance.pitch = 1.1; // éŸ³è°ƒ
                utterance.volume = 1.0; // éŸ³é‡

                // é€‰æ‹©æ›´è‡ªç„¶çš„å£°éŸ³ï¼ˆå¦‚æœæœ‰ï¼‰
                const voices = window.speechSynthesis.getVoices();
                const chineseVoices = voices.filter(voice => voice.lang.includes('zh'));
                if (chineseVoices.length > 0) {
                    // ä¼˜å…ˆé€‰æ‹©å¥³å£°
                    const femaleVoice = chineseVoices.find(voice => voice.name.includes('Female') || voice.name.includes('å¥³'));
                    utterance.voice = femaleVoice || chineseVoices[0];
                }

                // è¯­éŸ³äº‹ä»¶
                utterance.onstart = () => {
                    state.isSpeaking = true;
                    // è¯´è¯æ—¶æ’­æ”¾è¯´è¯åŠ¨ç”»
                    if (state.animations['Talking']) {
                        playAnimation('Talking');
                    }
                };

                utterance.onend = () => {
                    state.isSpeaking = false;
                    // è¯´è¯ç»“æŸåæ¢å¤åˆ°é»˜è®¤çŠ¶æ€
                    if (state.animations['Idle']) {
                        playAnimation('Idle');
                    }
                };

                window.speechSynthesis.speak(utterance);
            }
        }

        // è¯­éŸ³æš‚åœåŠŸèƒ½
        let currentUtterance = null;

        function pauseSpeech() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                state.isSpeaking = false;
                // æ¢å¤åˆ°å¾…æœºçŠ¶æ€
                setState('Idle');
                showNotification('è¯­éŸ³å·²æš‚åœ');
            }
        }

        // Chat Functionality
        async function sendMessage(message) {
            if (!message.trim()) return;

            // ç”¨æˆ·è¾“å…¥æ—¶è§¦å‘è·³èˆçŠ¶æ€
            setState('UserInput');

            // Save to chat history
            const timestamp = new Date().toLocaleString('zh-CN');
            state.chatHistory.push({ role: 'user', content: message, timestamp });
            localStorage.setItem('chatHistory', JSON.stringify(state.chatHistory));

            // Add user message
            const chatMessages = document.getElementById('chat-messages');
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble flex justify-end';
            userBubble.innerHTML = `
                <div class="glass-effect rounded-lg p-3 max-w-xs bg-green-500/80">
                    <p class="text-white text-sm">${message}</p>
                    <p class="text-white/70 text-xs mt-1">${timestamp}</p>
                </div>
            `;
            chatMessages.appendChild(userBubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            state.chatCount++;
            updateStatusPanel();
            playSound('message');

            // Show typing indicator - æ€è€ƒæ—¶è¿›å…¥å¥”è·‘çŠ¶æ€
            setState('Thinking');
            const typingBubble = document.createElement('div');
            typingBubble.className = 'chat-bubble';
            typingBubble.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-bold">ğŸŒ±</span>
                    </div>
                    <div class="glass-effect rounded-lg p-3">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingBubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Get AI response
            const startTime = performance.now();
            const response = await sendToDeepSeek(message);
            const endTime = performance.now();
            state.responseTime = (endTime - startTime) / 1000;

            // Remove typing indicator
            typingBubble.remove();

            // Analyze emotion
            const emotion = await analyzeEmotion(message);
            setState(emotion);

            // æ ¹æ®æ¶ˆæ¯å†…å®¹è§¦å‘ç‰¹å®šåŠ¨ä½œ
            if (message.toLowerCase().includes('hello') || message.includes('ä½ å¥½')) {
                playAnimation('Wave');
            } else if (message.toLowerCase().includes('yes') || message.includes('æ˜¯çš„') || message.includes('å¯¹')) {
                playAnimation('Yes');
            } else if (message.toLowerCase().includes('no') || message.includes('ä¸') || message.includes('å¦')) {
                playAnimation('No');
            } else if (message.toLowerCase().includes('thumbs up') || message.includes('ç‚¹èµ') || message.includes('å¥½')) {
                playAnimation('Thumbsup');
            } else if (message.toLowerCase().includes('punch') || message.includes('æ‹³å‡»') || message.includes('æ‰“')) {
                playAnimation('Punch');
            } else if (message.toLowerCase().includes('walk') || message.includes('èµ°')) {
                playAnimation('Walking');
            } else if (message.toLowerCase().includes('run') || message.includes('è·‘')) {
                playAnimation('Running');
            } else if (message.toLowerCase().includes('sit') || message.includes('å')) {
                playAnimation('Sitting');
            } else if (message.toLowerCase().includes('stand') || message.includes('ç«™')) {
                playAnimation('Standing');
            }

            // å›å¤æ—¶è®¾ç½®çŠ¶æ€
            setState('Replying');

            // Add AI response
            const aiBubble = document.createElement('div');
            aiBubble.className = 'chat-bubble';
            aiBubble.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-bold">ğŸŒ±</span>
                    </div>
                    <div class="glass-effect rounded-lg p-3 max-w-xs">
                        <p class="text-white text-sm">${response}</p>
                        <p class="text-white/70 text-xs mt-1">${timestamp}</p>
                    </div>
                </div>
            `;
            chatMessages.appendChild(aiBubble);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            state.chatHistory.push({ role: 'assistant', content: response, timestamp });
            localStorage.setItem('chatHistory', JSON.stringify(state.chatHistory));
            updateStatusPanel();

            // Speak response
            speak(response);

            // å›å¤å®Œæ¯•åè¿›å…¥å¾…æœºçŠ¶æ€
            setTimeout(() => {
                setState('Idle');
            }, 2000); // 2ç§’åè¿›å…¥å¾…æœºçŠ¶æ€

            // Trigger specific animations
            if (message.toLowerCase().includes('hello') || message.includes('ä½ å¥½')) {
                playAnimation('Wave');
            }
        }

        // Load Chat History
        function loadChatHistory() {
            const history = localStorage.getItem('chatHistory');
            if (history) {
                state.chatHistory = JSON.parse(history);
                const chatMessages = document.getElementById('chat-messages');
                state.chatHistory.forEach(msg => {
                    const bubble = document.createElement('div');
                    bubble.className = `chat-bubble ${msg.role === 'user' ? 'flex justify-end' : ''}`;
                    bubble.innerHTML = `
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white text-xs font-bold">${msg.role === 'user' ? 'U' : 'ğŸŒ±'}</span>
                            </div>
                            <div class="glass-effect rounded-lg p-3 max-w-xs ${msg.role === 'user' ? 'bg-green-500/80' : ''}">
                                <p class="text-white text-sm">${msg.content}</p>
                                <p class="text-white/70 text-xs mt-1">${msg.timestamp}</p>
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(bubble);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
                state.chatCount = state.chatHistory.filter(msg => msg.role === 'user').length;
                updateStatusPanel();
            }
        }

        // Display History Modal
        function showHistoryModal() {
            const historyMessages = document.getElementById('history-messages');
            historyMessages.innerHTML = '';
            state.chatHistory.forEach((msg, idx) => {
                const bubble = document.createElement('div');
                bubble.className = `chat-bubble ${msg.role === 'user' ? 'flex justify-end' : ''}`;
                bubble.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-xs font-bold">${msg.role === 'user' ? 'U' : 'ğŸŒ±'}</span>
                        </div>
                        <div class="glass-effect rounded-lg p-3 max-w-xs ${msg.role === 'user' ? 'bg-green-500/80' : ''}">
                            <p class="text-white text-sm">${msg.content}</p>
                            <p class="text-white/70 text-xs mt-1">${msg.timestamp}</p>
                            <div class="flex gap-2 mt-2">
                                <button class="copy-btn bg-blue-400 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs" data-idx="${idx}">å¤åˆ¶</button>
                                <button class="resend-btn bg-green-400 hover:bg-green-600 text-white px-2 py-1 rounded text-xs" data-idx="${idx}">é‡å‘</button>
                                <button class="delete-btn bg-red-400 hover:bg-red-600 text-white px-2 py-1 rounded text-xs" data-idx="${idx}">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                `;
                historyMessages.appendChild(bubble);
            });
            // æŒ‰é’®äº‹ä»¶
            historyMessages.querySelectorAll('.copy-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = this.getAttribute('data-idx');
                    navigator.clipboard.writeText(state.chatHistory[idx].content);
                    showNotification('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                };
            });
            historyMessages.querySelectorAll('.resend-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = this.getAttribute('data-idx');
                    sendMessage(state.chatHistory[idx].content);
                };
            });
            historyMessages.querySelectorAll('.delete-btn').forEach(btn => {
                btn.onclick = function() {
                    const idx = this.getAttribute('data-idx');
                    state.chatHistory.splice(idx, 1);
                    localStorage.setItem('chatHistory', JSON.stringify(state.chatHistory));
                    showHistoryModal();
                };
            });
            // æ¸…ç©ºå†å²
            document.getElementById('clear-history').onclick = function() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                    state.chatHistory = [];
                    localStorage.removeItem('chatHistory');
                    showHistoryModal();
                }
            };
            state.historyModalVisible = true;
            document.getElementById('history-modal').classList.remove('hidden');
        }

        // Update Role Display
        function updateRoleDisplay() {
            document.getElementById('app-title').textContent = `${state.roleName} - æ™ºæ…§å†œåœºåŠ©æ‰‹`;
            document.getElementById('chat-header').textContent = `${state.roleName} - æ™ºæ…§å†œåœºåŠ©æ‰‹`;
        }

        // Apply User Settings
        function applySettings() {
            document.body.className = `min-h-screen ${state.theme} overflow-hidden`;
            document.querySelector('.main-container').className = `main-container flex h-[calc(100vh-80px)] ${state.layout}-layout`;
            document.getElementById('layout-select').value = state.layout;
            document.getElementById('theme-select').value = state.theme;
            document.getElementById('animation-speed').value = state.animationSpeed;
            document.getElementById('tts-toggle').checked = state.ttsEnabled;
            document.getElementById('role-name').value = state.roleName;
            document.getElementById('model-select').value = state.currentModel;
            document.getElementById('mouse-follow').checked = state.mouseFollow;
            localStorage.setItem('settings', JSON.stringify({
                layout: state.layout,
                theme: state.theme,
                animationSpeed: state.animationSpeed,
                ttsEnabled: state.ttsEnabled,
                roleName: state.roleName,
                currentModel: state.currentModel,
                mouseFollow: state.mouseFollow
            }));
            updateRoleDisplay();
        }

        // Load User Settings
        function loadSettings() {
            const settings = localStorage.getItem('settings');
            if (settings) {
                const parsed = JSON.parse(settings);
                state.layout = parsed.layout || 'horizontal';
                state.theme = parsed.theme || 'gradient-bg';
                state.animationSpeed = parsed.animationSpeed || 1;
                state.ttsEnabled = parsed.ttsEnabled || false;
                state.roleName = parsed.roleName || 'å°è‰¾';
                state.currentModel = parsed.currentModel || 'xiaoai';
                state.mouseFollow = parsed.mouseFollow !== undefined ? parsed.mouseFollow : true;
            }
            applySettings();
        }

        // Chat Panel Width Adjustment
        function initDivider() {
            const divider = document.getElementById('divider');
            const chatPanel = document.getElementById('chat-panel');
            let isDragging = false;

            divider.addEventListener('mousedown', () => {
                isDragging = true;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging && window.innerWidth > 768) {
                    const newWidth = window.innerWidth - e.clientX;
                    if (newWidth >= 200 && newWidth <= 600) {
                        chatPanel.style.width = `${newWidth}px`;
                    }
                }
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    localStorage.setItem('chatWidth', chatPanel.style.width);
                    isDragging = false;
                }
            });

            const savedWidth = localStorage.getItem('chatWidth');
            if (savedWidth) {
                chatPanel.style.width = savedWidth;
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Three.js
            const { loadModel } = initThreeJS();

            // Initialize Map
            initMap();

            // Initialize Speech Recognition
            initSpeechRecognition();

            // Initialize Divider
            initDivider();

            // Load Settings and Chat History
            loadSettings();
            loadChatHistory();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 2000);

            // Navigation Buttons
            document.getElementById('location-btn').addEventListener('click', () => {
                getCurrentLocation();
            });

            // Map Toggle
            document.getElementById('map-toggle').addEventListener('click', () => {
                const mapOverlay = document.getElementById('map-overlay');
                state.mapVisible = !state.mapVisible;
                if (state.mapVisible) {
                    mapOverlay.classList.remove('hidden');
                    document.getElementById('map-toggle').innerHTML = `
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 001.414-1.414L9.707 9.293V6z" clip-rule="evenodd"></path>
                        </svg>
                    `;
                } else {
                    mapOverlay.classList.add('hidden');
                    document.getElementById('map-toggle').innerHTML = `
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12 1.586l-4 4v12.828l4-4V1.586zM3.707 3.293A1 1 0 002 4v10a1 1 0 10.293.707L6 18.414V5.586L3.707 3.293zM17.707 5.293L14 1.586v12.828l2.293 2.293A1 1 0 0018 16V6a1 1 0 00-.293-.707z" clip-rule="evenodd"></path>
                        </svg>
                    `;
                }
            });

            document.getElementById('refresh-btn').addEventListener('click', async () => {
                const correctApiKey = "123666";

                const enteredKey = prompt("è¯·è¾“å…¥è®¿é—®å¯†é’¥ä»¥åˆ·æ–°æ•°æ®åº“å†…å®¹ï¼š");

                if (!enteredKey || enteredKey.trim() !== correctApiKey) {
                    showNotification("âŒ å¯†é’¥é”™è¯¯ï¼Œæ— æ³•åˆ·æ–°æ•°æ®åº“å†…å®¹", 'error');
                    return;
                }

                try {
                    const response = await fetch('/combined.txt');  // ç¡®ä¿è·¯å¾„æ­£ç¡®
                    const text = await response.text();

                    // å°†æ•°æ®åº“å†…å®¹ä¿å­˜åˆ°å…¨å±€å˜é‡æˆ– state ä¸­
                    databaseContent = text;

                    // è®¾ç½®æ ‡å¿—ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¬¡è°ƒç”¨ sendToDeepSeek åº”è¯¥æ³¨å…¥æ•°æ®åº“å†…å®¹
                    state.shouldInjectDatabase = true;

                    showNotification("âœ… æ•°æ®åº“å†…å®¹å·²åˆ·æ–°å¹¶å°†åœ¨ä¸‹æ¬¡å¯¹è¯ä¸­æ³¨å…¥");
                } catch (error) {
                    console.error('æ•°æ®åº“åˆ·æ–°å¤±è´¥:', error);
                    showNotification("âŒ åˆ·æ–°æ•°æ®åº“å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æˆ–ç½‘ç»œ", 'error');
                }
            });




            // Close Map
            document.getElementById('close-map').addEventListener('click', () => {
                document.getElementById('map-overlay').classList.add('hidden');
                state.mapVisible = false;
                document.getElementById('map-toggle').innerHTML = `
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M12 1.586l-4 4v12.828l4-4V1.586zM3.707 3.293A1 1 0 002 4v10a1 1 0 10.293.707L6 18.414V5.586L3.707 3.293zM17.707 5.293L14 1.586v12.828l2.293 2.293A1 1 0 0018 16V6a1 1 0 00-.293-.707z" clip-rule="evenodd"></path>
                    </svg>
                `;
            });

            // Services Button
            document.getElementById('services-btn').addEventListener('click', () => {
                state.servicesModalVisible = !state.servicesModalVisible;
                document.getElementById('services-modal').classList.toggle('hidden');
            });

            // Close Services Modal
            document.getElementById('close-services').addEventListener('click', () => {
                state.servicesModalVisible = false;
                document.getElementById('services-modal').classList.add('hidden');
            });

            // Service Buttons
            document.querySelectorAll('.service-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const service = btn.getAttribute('data-service');
                    switch (service) {
                        case 'ai-chat':
                            if (!state.servicesModalVisible) {
                                state.servicesModalVisible = true;
                                document.getElementById('services-modal').classList.remove('hidden');
                            } else {
                                document.getElementById('services-modal').classList.add('hidden');
                                state.servicesModalVisible = false;
                            }
                            break;
                        case 'navigation':
                            document.getElementById('map-overlay').classList.remove('hidden');
                            state.mapVisible = true;
                            document.getElementById('map-toggle').innerHTML = `
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 001.414-1.414L9.707 9.293V6z" clip-rule="evenodd"></path>
                                </svg>
                            `;
                            break;
                        case 'email':
                            const to = prompt('è¯·è¾“å…¥æ”¶ä»¶äººé‚®ç®±:');
                            if (to) {
                                const subject = prompt('è¯·è¾“å…¥é‚®ä»¶ä¸»é¢˜:');
                                if (subject) {
                                    const body = prompt('è¯·è¾“å…¥é‚®ä»¶å†…å®¹:');
                                    if (body) {
                                        sendEmail(to, subject, body);
                                        showNotification('é‚®ä»¶å·²å‘é€');
                                    }
                                }
                            }
                            break;
                        case 'settings':
                            state.settingsModalVisible = true;
                            document.getElementById('settings-modal').classList.remove('hidden');
                            break;
                        case 'system-status':
                            showNotification('ç³»ç»ŸçŠ¶æ€æ­£å¸¸ï¼Œæ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸');
                            break;
                    }
                });
            });

            // Close Settings Modal
            document.getElementById('close-settings').addEventListener('click', () => {
                state.settingsModalVisible = false;
                document.getElementById('settings-modal').classList.add('hidden');
            });

            // Save Settings
            document.getElementById('save-settings').addEventListener('click', () => {
                state.layout = document.getElementById('layout-select').value;
                state.theme = document.getElementById('theme-select').value;
                state.animationSpeed = parseFloat(document.getElementById('animation-speed').value);
                state.ttsEnabled = document.getElementById('tts-toggle').checked;
                state.roleName = document.getElementById('role-name').value;
                state.currentModel = document.getElementById('model-select').value;
                state.mouseFollow = document.getElementById('mouse-follow').checked;
                applySettings();
                showNotification('è®¾ç½®å·²ä¿å­˜');
                loadModel(state.currentModel);
                state.settingsModalVisible = false;
                document.getElementById('settings-modal').classList.add('hidden');
            });

            // Quick Actions
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.addEventListener('click', () => {
                    const action = btn.getAttribute('data-action');
                    switch (action) {
                        case 'navigation':
                            document.getElementById('map-overlay').classList.remove('hidden');
                            state.mapVisible = true;
                            document.getElementById('map-toggle').innerHTML = `
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 001.414-1.414L9.707 9.293V6z" clip-rule="evenodd"></path>
                                </svg>
                            `;
                            break;
                        case 'weather':
                            if (state.currentPosition) {
                                getWeather(state.currentPosition.lat, state.currentPosition.lng);
                            } else {
                                showNotification('è¯·å…ˆè·å–ä½ç½®ä¿¡æ¯', 'error');
                            }
                            break;
                        case 'email':
                            const to = prompt('è¯·è¾“å…¥æ”¶ä»¶äººé‚®ç®±:');
                            if (to) {
                                const subject = prompt('è¯·è¾“å…¥é‚®ä»¶ä¸»é¢˜:');
                                if (subject) {
                                    const body = prompt('è¯·è¾“å…¥é‚®ä»¶å†…å®¹:');
                                    if (body) {
                                        sendEmail(to, subject, body);
                                        showNotification('é‚®ä»¶å·²å‘é€');
                                    }
                                }
                            }
                            break;
                        case 'settings':
                            state.settingsModalVisible = true;
                            document.getElementById('settings-modal').classList.remove('hidden');
                            break;
                        case 'history':
                            state.historyModalVisible = true;
                            showHistoryModal();
                            break;
                    }
                });
            });

            // Close History Modal
            document.getElementById('close-history').addEventListener('click', () => {
                state.historyModalVisible = false;
                document.getElementById('history-modal').classList.add('hidden');
            });

            // Send Message
            document.getElementById('send-btn').addEventListener('click', () => {
                const message = document.getElementById('message-input').value;
                sendMessage(message);
                document.getElementById('message-input').value = '';
            });

            document.getElementById('message-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const message = document.getElementById('message-input').value;
                    sendMessage(message);
                    document.getElementById('message-input').value = '';
                }
            });

            // Voice Recognition
            document.getElementById('voice-btn').addEventListener('click', () => {
                toggleVoiceRecognition();
            });

            // æ›´æ–°å³é”®èœå•
            const contextMenu = document.getElementById('context-menu');
            contextMenu.innerHTML = `
                <a href="#" data-action="wave">æŒ¥æ‰‹åŠ¨ç”»</a>
                <a href="#" data-action="idle">å¾…æœºåŠ¨ç”»</a>
                <a href="#" data-action="dance">è·³èˆåŠ¨ç”»</a>
                <a href="#" data-action="walking">è¡Œèµ°åŠ¨ç”»</a>
                <a href="#" data-action="running">è·‘æ­¥åŠ¨ç”»</a>
                <a href="#" data-action="sitting">åä¸‹åŠ¨ç”»</a>
                <a href="#" data-action="standing">ç«™ç«‹åŠ¨ç”»</a>
                <a href="#" data-action="yes">ç‚¹å¤´åŠ¨ä½œ</a>
                <a href="#" data-action="no">æ‘‡å¤´åŠ¨ä½œ</a>
                <a href="#" data-action="punch">æ‹³å‡»åŠ¨ä½œ</a>
                <a href="#" data-action="thumbsup">ç‚¹èµåŠ¨ä½œ</a>
                <a href="#" data-action="happy">å¼€å¿ƒè¡¨æƒ…</a>
                <a href="#" data-action="sad">æ‚²ä¼¤è¡¨æƒ…</a>
                <a href="#" data-action="angry">ç”Ÿæ°”è¡¨æƒ…</a>
                <a href="#" data-action="surprised">æƒŠè®¶è¡¨æƒ…</a>
                <a href="#" data-action="neutral">ä¸­æ€§è¡¨æƒ…</a>
                <a href="#" data-action="reset">é‡ç½®è§†è§’</a>
            `;

            // å³é”®èœå•äº‹ä»¶
            document.querySelectorAll('#context-menu a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const action = link.getAttribute('data-action');

                    // å¤„ç†è¡¨æƒ…
                    if (state.availableExpressions.includes(action)) {
                        setExpression(action);
                    }
                    // å¤„ç†åŠ¨ç”»å’ŒåŠ¨ä½œ
                    else if (state.availableStates.includes(action) ||
                             state.availableEmotes.includes(action) ||
                             ['wave', 'idle', 'dance'].includes(action)) {
                        // é¦–å­—æ¯å¤§å†™
                        const animName = action.charAt(0).toUpperCase() + action.slice(1);
                        playAnimation(animName);
                    }
                    // é‡ç½®è§†è§’
                    else if (action === 'reset') {
                        resetCamera();
                    }

                    document.getElementById('context-menu').style.display = 'none';
                });
            });

            // Map Search
            document.getElementById('poi-search').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const keyword = document.getElementById('poi-search').value;
                    searchPOI(keyword);
                }
            });

            // Navigation Actions
            document.querySelectorAll('.nav-dropdown a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const action = link.getAttribute('data-action');
                    switch (action) {
                        case 'current-location':
                            getCurrentLocation();
                            break;
                        case 'search-poi':
                            const keyword = prompt('è¯·è¾“å…¥è¦æœç´¢çš„åœ°ç‚¹:');
                            if (keyword) {
                                searchPOI(keyword);
                            }
                            break;
                        case 'route-plan':
                            const destination = prompt('è¯·è¾“å…¥ç›®çš„åœ°:');
                            if (destination && state.currentPosition) {
                                planRoute(destination);
                            } else {
                                showNotification('è¯·å…ˆè·å–å½“å‰ä½ç½®æˆ–è¾“å…¥æœ‰æ•ˆç›®çš„åœ°', 'error');
                            }
                            break;
                    }
                });
            });

            // Set Initial Status
            updateStatusPanel();
        });

        // å‘é€å»ºè®®æŒ‰é’®äº‹ä»¶
        if (document.getElementById('send-suggestion')) {
            document.getElementById('send-suggestion').addEventListener('click', () => {
                const content = prompt('è¯·è¾“å…¥æ‚¨çš„å»ºè®®ï¼š');
                if (content) sendSuggestion(content);
            });
        }
        if (document.getElementById('service-suggestion-btn')) {
            document.getElementById('service-suggestion-btn').addEventListener('click', () => {
                const content = prompt('è¯·è¾“å…¥æ‚¨çš„å»ºè®®ï¼š');
                if (content) sendSuggestion(content);
            });
        }

        // é‚®ä»¶æœåŠ¡æ”¹ä¸ºå‘é€å»ºè®®
        function sendSuggestion(content) {
            window.open('mailto:2138277532@qq.com?subject=å»ºè®®åé¦ˆ&body=' + encodeURIComponent(content));
            showNotification('å·²æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯ï¼Œè¯·å‘é€æ‚¨çš„å»ºè®®');
        }
    </script>
</body>
</html>